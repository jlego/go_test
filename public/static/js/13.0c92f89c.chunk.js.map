{"version":3,"sources":["../../src/base64.ts","../../src/utils.ts","../../src/statisticsLog.ts","../../src/pool.ts","../../src/config.ts","../../src/api.ts","../../../src/upload/base.ts","../../../src/upload/resume.ts","../../../src/upload/direct.ts","../../src/observable.ts","../../src/compress.ts","../../src/index.ts","../../../src/upload/index.ts","../node_modules/spark-md5/spark-md5.js","../node_modules/exif-js/exif.js"],"names":["xhr","this","module","exports","undefined","hex_chr","md5cycle","x","k","a","b","c","d","md5blk","s","i","md5blks","charCodeAt","md5blk_array","md51","length","tail","tmp","lo","hi","n","state","substring","toString","match","parseInt","md51_array","subarray","Uint8Array","rhex","j","hex","join","toUtf8","str","test","unescape","encodeURIComponent","utf8Str2ArrayBuffer","returnUInt8Array","buff","ArrayBuffer","arr","arrayBuffer2Utf8Str","String","fromCharCode","apply","concatenateArrayBuffers","first","second","result","byteLength","set","buffer","hexToBinaryString","bytes","push","substr","SparkMD5","reset","prototype","slice","clamp","val","Math","max","min","from","to","num","target","targetArray","sourceArray","begin","end","append","appendBinary","contents","_buff","_length","_hash","raw","ret","_finish","getState","hash","setState","destroy","hashBinary","content","call","factory","debug","EXIF","obj","EXIFwrapped","ExifTags","Tags","TiffTags","GPSTags","0","IFD1Tags","StringValues","ExposureProgram","1","2","3","4","5","6","7","8","MeteringMode","255","LightSource","9","10","11","12","13","14","15","17","18","19","20","21","22","23","24","Flash","SensingMethod","SceneCaptureType","SceneType","CustomRendered","WhiteBalance","GainControl","Contrast","Saturation","Sharpness","SubjectDistanceRange","FileSource","Components","imageHasData","img","exifdata","getImageData","callback","handleBinaryFile","binFile","data","findEXIFinJPEG","iptcdata","file","dataView","DataView","getUint8","offset","isFieldSegmentStart","nameHeaderLength","readIPTCData","getUint16","findIPTCinJPEG","isXmpEnabled","xmpdata","self","dom","DOMParser","getStringFromDB","startOffset","sectionLength","xmpString","xmpEndIndex","indexOf","indexOfXmp","xml2Object","parseFromString","findXMPinJPEG","src","base64","contentType","replace","binary","atob","len","view","base64ToArrayBuffer","fileReader","FileReader","onload","e","url","http","XMLHttpRequest","open","responseType","status","response","send","objectURLToBlob","blob","readAsArrayBuffer","Blob","File","readEXIFData","IptcFieldMap","fieldValue","fieldName","dataSize","segmentType","segmentStartPos","getInt16","hasOwnProperty","Array","readTags","tiffStart","dirStart","strings","bigEnd","entryOffset","entries","tags","readTagValue","vals","numerator","denominator","type","numValues","getUint32","valueOffset","Number","getInt32","start","outstr","tag","exifData","gpsData","tiffOffset","firstIFDOffset","ExifIFDPointer","GPSInfoIFDPointer","IFD1OffsetPointer","getNextIFDOffset","thumbTags","JpegIFOffset","JpegIFByteCount","tOffset","tLength","console","log","readThumbnailImage","xml2json","xml","json","nodeType","attributes","attribute","item","nodeName","nodeValue","hasChildNodes","childNodes","child","old","children","idx","itemAtt","dataKey","dataValue","textContent","message","enableXmp","disableXmp","getData","Image","HTMLImageElement","complete","getTag","getIptcTag","getAllTags","getAllIptcTags","pretty","strPretty","readFromBinaryFile"],"mappings":"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","file":"static/js/13.0c92f89c.chunk.js","sourcesContent":["/* eslint-disable */\nexport function utf8Encode(argString) {\n    // http://kevin.vanzonneveld.net\n    // +   original by: Webtoolkit.info (http://www.webtoolkit.info/)\n    // +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\n    // +   improved by: sowberry\n    // +    tweaked by: Jack\n    // +   bugfixed by: Onno Marsman\n    // +   improved by: Yves Sucaet\n    // +   bugfixed by: Onno Marsman\n    // +   bugfixed by: Ulrich\n    // +   bugfixed by: Rafal Kukawski\n    // +   improved by: kirilloid\n    // +   bugfixed by: kirilloid\n    // *     example 1: this.utf8Encode('Kevin van Zonneveld')\n    // *     returns 1: 'Kevin van Zonneveld'\n    if (argString === null || typeof argString === 'undefined') {\n        return '';\n    }\n    var string = argString + ''; // .replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n')\n    var utftext = '', start, end, stringl = 0;\n    start = end = 0;\n    stringl = string.length;\n    for (var n = 0; n < stringl; n++) {\n        var c1 = string.charCodeAt(n);\n        var enc = null;\n        if (c1 < 128) {\n            end++;\n        }\n        else if (c1 > 127 && c1 < 2048) {\n            enc = String.fromCharCode((c1 >> 6) | 192, (c1 & 63) | 128);\n        }\n        else if ((c1 & 0xf800 ^ 0xd800) > 0) {\n            enc = String.fromCharCode((c1 >> 12) | 224, ((c1 >> 6) & 63) | 128, (c1 & 63) | 128);\n        }\n        else {\n            // surrogate pairs\n            if ((c1 & 0xfc00 ^ 0xd800) > 0) {\n                throw new RangeError('Unmatched trail surrogate at ' + n);\n            }\n            var c2 = string.charCodeAt(++n);\n            if ((c2 & 0xfc00 ^ 0xdc00) > 0) {\n                throw new RangeError('Unmatched lead surrogate at ' + (n - 1));\n            }\n            c1 = ((c1 & 0x3ff) << 10) + (c2 & 0x3ff) + 0x10000;\n            enc = String.fromCharCode((c1 >> 18) | 240, ((c1 >> 12) & 63) | 128, ((c1 >> 6) & 63) | 128, (c1 & 63) | 128);\n        }\n        if (enc !== null) {\n            if (end > start) {\n                utftext += string.slice(start, end);\n            }\n            utftext += enc;\n            start = end = n + 1;\n        }\n    }\n    if (end > start) {\n        utftext += string.slice(start, stringl);\n    }\n    return utftext;\n}\nexport function base64Encode(data) {\n    // http://kevin.vanzonneveld.net\n    // +   original by: Tyler Akins (http://rumkin.com)\n    // +   improved by: Bayron Guevara\n    // +   improved by: Thunder.m\n    // +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\n    // +   bugfixed by: Pellentesque Malesuada\n    // +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\n    // -    depends on: this.utf8Encode\n    // *     example 1: this.base64Encode('Kevin van Zonneveld')\n    // *     returns 1: 'S2V2aW4gdmFuIFpvbm5ldmVsZA=='\n    // mozilla has this native\n    // - but breaks in 2.0.0.12!\n    // if (typeof this.window['atob'] == 'function') {\n    //    return atob(data)\n    // }\n    var b64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n    var o1, o2, o3, h1, h2, h3, h4, bits, i = 0, ac = 0, enc = '', tmp_arr = [];\n    if (!data) {\n        return data;\n    }\n    data = utf8Encode(data + '');\n    do {\n        // pack three octets into four hexets\n        o1 = data.charCodeAt(i++);\n        o2 = data.charCodeAt(i++);\n        o3 = data.charCodeAt(i++);\n        bits = (o1 << 16) | (o2 << 8) | o3;\n        h1 = (bits >> 18) & 0x3f;\n        h2 = (bits >> 12) & 0x3f;\n        h3 = (bits >> 6) & 0x3f;\n        h4 = bits & 0x3f;\n        // use hexets to index into b64, and append result to encoded string\n        tmp_arr[ac++] =\n            b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4);\n    } while (i < data.length);\n    enc = tmp_arr.join('');\n    switch (data.length % 3) {\n        case 1:\n            enc = enc.slice(0, -2) + '==';\n            break;\n        case 2:\n            enc = enc.slice(0, -1) + '=';\n            break;\n    }\n    return enc;\n}\nexport function base64Decode(data) {\n    // http://kevin.vanzonneveld.net\n    // +   original by: Tyler Akins (http://rumkin.com)\n    // +   improved by: Thunder.m\n    // +      input by: Aman Gupta\n    // +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\n    // +   bugfixed by: Onno Marsman\n    // +   bugfixed by: Pellentesque Malesuada\n    // +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\n    // +      input by: Brett Zamir (http://brett-zamir.me)\n    // +   bugfixed by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\n    // *     example 1: base64_decode('S2V2aW4gdmFuIFpvbm5ldmVsZA==')\n    // *     returns 1: 'Kevin van Zonneveld'\n    // mozilla has this native\n    // - but breaks in 2.0.0.12!\n    // if (typeof this.window['atob'] == 'function') {\n    //    return atob(data)\n    // }\n    var b64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n    var o1, o2, o3, h1, h2, h3, h4, bits, i = 0, ac = 0, dec = '', tmp_arr = [];\n    if (!data) {\n        return data;\n    }\n    data += '';\n    do { // unpack four hexets into three octets using index points in b64\n        h1 = b64.indexOf(data.charAt(i++));\n        h2 = b64.indexOf(data.charAt(i++));\n        h3 = b64.indexOf(data.charAt(i++));\n        h4 = b64.indexOf(data.charAt(i++));\n        bits = h1 << 18 | h2 << 12 | h3 << 6 | h4;\n        o1 = bits >> 16 & 0xff;\n        o2 = bits >> 8 & 0xff;\n        o3 = bits & 0xff;\n        if (h3 === 64) {\n            tmp_arr[ac++] = String.fromCharCode(o1);\n        }\n        else if (h4 === 64) {\n            tmp_arr[ac++] = String.fromCharCode(o1, o2);\n        }\n        else {\n            tmp_arr[ac++] = String.fromCharCode(o1, o2, o3);\n        }\n    } while (i < data.length);\n    dec = tmp_arr.join('');\n    return dec;\n}\nexport function urlSafeBase64Encode(v) {\n    v = base64Encode(v);\n    return v.replace(/\\//g, '_').replace(/\\+/g, '-');\n}\nexport function urlSafeBase64Decode(v) {\n    v = v.replace(/_/g, '/').replace(/-/g, '+');\n    return base64Decode(v);\n}\n//# sourceMappingURL=base64.js.map","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport SparkMD5 from 'spark-md5';\nimport { urlSafeBase64Decode } from './base64';\nexport var MB = Math.pow(1024, 2);\n// 文件分块\nexport function getChunks(file, blockSize) {\n    var chunkByteSize = blockSize * MB; // 转换为字节\n    // 如果 chunkByteSize 比文件大，则直接取文件的大小\n    if (chunkByteSize > file.size) {\n        chunkByteSize = file.size;\n    }\n    else {\n        // 因为最多 10000 chunk，所以如果 chunkSize 不符合则把每片 chunk 大小扩大两倍\n        while (file.size > chunkByteSize * 10000) {\n            chunkByteSize *= 2;\n        }\n    }\n    var chunks = [];\n    var count = Math.ceil(file.size / chunkByteSize);\n    for (var i = 0; i < count; i++) {\n        var chunk = file.slice(chunkByteSize * i, i === count - 1 ? file.size : chunkByteSize * (i + 1));\n        chunks.push(chunk);\n    }\n    return chunks;\n}\nexport function isMetaDataValid(params) {\n    return Object.keys(params).every(function (key) { return key.indexOf('x-qn-meta-') === 0; });\n}\nexport function isCustomVarsValid(params) {\n    return Object.keys(params).every(function (key) { return key.indexOf('x:') === 0; });\n}\nexport function sum(list) {\n    return list.reduce(function (data, loaded) { return data + loaded; }, 0);\n}\nexport function setLocalFileInfo(localKey, info) {\n    try {\n        localStorage.setItem(localKey, JSON.stringify(info));\n    }\n    catch (err) {\n        if (window.console && window.console.warn) {\n            // eslint-disable-next-line no-console\n            console.warn('setLocalFileInfo failed');\n        }\n    }\n}\nexport function createLocalKey(name, key, size) {\n    var localKey = key == null ? '_' : \"_key_\" + key + \"_\";\n    return \"qiniu_js_sdk_upload_file_name_\" + name + localKey + \"size_\" + size;\n}\nexport function removeLocalFileInfo(localKey) {\n    try {\n        localStorage.removeItem(localKey);\n    }\n    catch (err) {\n        if (window.console && window.console.warn) {\n            // eslint-disable-next-line no-console\n            console.warn('removeLocalFileInfo failed');\n        }\n    }\n}\nexport function getLocalFileInfo(localKey) {\n    try {\n        var localInfo = localStorage.getItem(localKey);\n        return localInfo ? JSON.parse(localInfo) : null;\n    }\n    catch (err) {\n        if (window.console && window.console.warn) {\n            // eslint-disable-next-line no-console\n            console.warn('getLocalFileInfo failed');\n        }\n        return null;\n    }\n}\nexport function getAuthHeaders(token) {\n    var auth = 'UpToken ' + token;\n    return { Authorization: auth };\n}\nexport function getHeadersForChunkUpload(token) {\n    var header = getAuthHeaders(token);\n    return __assign({ 'content-type': 'application/octet-stream' }, header);\n}\nexport function getHeadersForMkFile(token) {\n    var header = getAuthHeaders(token);\n    return __assign({ 'content-type': 'application/json' }, header);\n}\nexport function createXHR() {\n    if (window.XMLHttpRequest) {\n        return new XMLHttpRequest();\n    }\n    return window.ActiveXObject('Microsoft.XMLHTTP');\n}\nexport function computeMd5(data) {\n    return __awaiter(this, void 0, void 0, function () {\n        var buffer, spark;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, readAsArrayBuffer(data)];\n                case 1:\n                    buffer = _a.sent();\n                    spark = new SparkMD5.ArrayBuffer();\n                    spark.append(buffer);\n                    return [2 /*return*/, spark.end()];\n            }\n        });\n    });\n}\nexport function readAsArrayBuffer(data) {\n    return new Promise(function (resolve, reject) {\n        var reader = new FileReader();\n        // evt 类型目前存在问题 https://github.com/Microsoft/TypeScript/issues/4163\n        reader.onload = function (evt) {\n            if (evt.target) {\n                var body = evt.target.result;\n                resolve(body);\n            }\n            else {\n                reject(new Error('progress event target is undefined'));\n            }\n        };\n        reader.onerror = function () {\n            reject(new Error('fileReader read failed'));\n        };\n        reader.readAsArrayBuffer(data);\n    });\n}\nexport function request(url, options) {\n    return new Promise(function (resolve, reject) {\n        var xhr = createXHR();\n        xhr.open(options.method, url);\n        if (options.onCreate) {\n            options.onCreate(xhr);\n        }\n        if (options.headers) {\n            var headers_1 = options.headers;\n            Object.keys(headers_1).forEach(function (k) {\n                xhr.setRequestHeader(k, headers_1[k]);\n            });\n        }\n        xhr.upload.addEventListener('progress', function (evt) {\n            if (evt.lengthComputable && options.onProgress) {\n                options.onProgress({\n                    loaded: evt.loaded,\n                    total: evt.total\n                });\n            }\n        });\n        xhr.onreadystatechange = function () {\n            var responseText = xhr.responseText;\n            if (xhr.readyState !== 4) {\n                return;\n            }\n            var reqId = xhr.getResponseHeader('x-reqId') || '';\n            if (xhr.status !== 200) {\n                var message = \"xhr request failed, code: \" + xhr.status;\n                if (responseText) {\n                    message += \" response: \" + responseText;\n                }\n                reject({\n                    code: xhr.status,\n                    message: message,\n                    reqId: reqId,\n                    isRequestError: true\n                });\n                return;\n            }\n            try {\n                resolve({\n                    data: JSON.parse(responseText),\n                    reqId: reqId\n                });\n            }\n            catch (err) {\n                reject(err);\n            }\n        };\n        xhr.send(options.body);\n    });\n}\nexport function getPortFromUrl(url) {\n    if (url && url.match) {\n        var groups = url.match(/(^https?)/);\n        if (!groups) {\n            return '';\n        }\n        var type = groups[1];\n        groups = url.match(/^https?:\\/\\/([^:^/]*):(\\d*)/);\n        if (groups) {\n            return groups[2];\n        }\n        if (type === 'http') {\n            return '80';\n        }\n        return '443';\n    }\n    return '';\n}\nexport function getDomainFromUrl(url) {\n    if (url && url.match) {\n        var groups = url.match(/^https?:\\/\\/([^:^/]*)/);\n        return groups ? groups[1] : '';\n    }\n    return '';\n}\nexport function getPutPolicy(token) {\n    var segments = token.split(':');\n    // token 构造的差异参考：https://github.com/qbox/product/blob/master/kodo/auths/UpToken.md#admin-uptoken-authorization\n    var ak = segments.length > 3 ? segments[1] : segments[0];\n    var putPolicy = JSON.parse(urlSafeBase64Decode(segments[segments.length - 1]));\n    return {\n        ak: ak,\n        bucket: putPolicy.scope.split(':')[0]\n    };\n}\nexport function createObjectURL(file) {\n    var URL = window.URL || window.webkitURL || window.mozURL;\n    return URL.createObjectURL(file);\n}\nexport function getTransform(image, orientation) {\n    var width = image.width, height = image.height;\n    switch (orientation) {\n        case 1:\n            // default\n            return {\n                width: width,\n                height: height,\n                matrix: [1, 0, 0, 1, 0, 0]\n            };\n        case 2:\n            // horizontal flip\n            return {\n                width: width,\n                height: height,\n                matrix: [-1, 0, 0, 1, width, 0]\n            };\n        case 3:\n            // 180° rotated\n            return {\n                width: width,\n                height: height,\n                matrix: [-1, 0, 0, -1, width, height]\n            };\n        case 4:\n            // vertical flip\n            return {\n                width: width,\n                height: height,\n                matrix: [1, 0, 0, -1, 0, height]\n            };\n        case 5:\n            // vertical flip + -90° rotated\n            return {\n                width: height,\n                height: width,\n                matrix: [0, 1, 1, 0, 0, 0]\n            };\n        case 6:\n            // -90° rotated\n            return {\n                width: height,\n                height: width,\n                matrix: [0, 1, -1, 0, height, 0]\n            };\n        case 7:\n            // horizontal flip + -90° rotate\n            return {\n                width: height,\n                height: width,\n                matrix: [0, -1, -1, 0, height, width]\n            };\n        case 8:\n            // 90° rotated\n            return {\n                width: height,\n                height: width,\n                matrix: [0, -1, 1, 0, 0, width]\n            };\n        default:\n            throw new Error(\"orientation \" + orientation + \" is unavailable\");\n    }\n}\n//# sourceMappingURL=utils.js.map","import { createXHR } from './utils';\nvar StatisticsLogger = /** @class */ (function () {\n    function StatisticsLogger() {\n    }\n    StatisticsLogger.prototype.log = function (info, token) {\n        var logString = Object.values(info).join(',');\n        this.send(logString, token, 0);\n    };\n    StatisticsLogger.prototype.send = function (logString, token, retryCount) {\n        var _this = this;\n        var xhr = createXHR();\n        xhr.open('POST', 'https://uplog.qbox.me/log/3');\n        xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n        xhr.setRequestHeader('Authorization', 'UpToken ' + token);\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState === 4 && xhr.status !== 200 && ++retryCount <= 3) {\n                _this.send(logString, token, retryCount);\n            }\n        };\n        xhr.send(logString);\n    };\n    return StatisticsLogger;\n}());\nexport default StatisticsLogger;\n//# sourceMappingURL=statisticsLog.js.map","var Pool = /** @class */ (function () {\n    function Pool(runTask, limit) {\n        this.runTask = runTask;\n        this.limit = limit;\n        this.queue = [];\n        this.processing = [];\n    }\n    Pool.prototype.enqueue = function (task) {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            _this.queue.push({\n                task: task,\n                resolve: resolve,\n                reject: reject\n            });\n            _this.check();\n        });\n    };\n    Pool.prototype.run = function (item) {\n        var _this = this;\n        this.queue = this.queue.filter(function (v) { return v !== item; });\n        this.processing.push(item);\n        this.runTask(item.task).then(function () {\n            _this.processing = _this.processing.filter(function (v) { return v !== item; });\n            item.resolve();\n            _this.check();\n        }, function (err) { return item.reject(err); });\n    };\n    Pool.prototype.check = function () {\n        var _this = this;\n        var processingNum = this.processing.length;\n        var availableNum = this.limit - processingNum;\n        this.queue.slice(0, availableNum).forEach(function (item) {\n            _this.run(item);\n        });\n    };\n    return Pool;\n}());\nexport { Pool };\n//# sourceMappingURL=pool.js.map","var _a;\n/** 上传区域 */\nexport var region = {\n    z0: 'z0',\n    z1: 'z1',\n    z2: 'z2',\n    na0: 'na0',\n    as0: 'as0'\n};\n/** 上传区域对应的 host */\nexport var regionUphostMap = (_a = {},\n    _a[region.z0] = {\n        srcUphost: 'up.qiniup.com',\n        cdnUphost: 'upload.qiniup.com'\n    },\n    _a[region.z1] = {\n        srcUphost: 'up-z1.qiniup.com',\n        cdnUphost: 'upload-z1.qiniup.com'\n    },\n    _a[region.z2] = {\n        srcUphost: 'up-z2.qiniup.com',\n        cdnUphost: 'upload-z2.qiniup.com'\n    },\n    _a[region.na0] = {\n        srcUphost: 'up-na0.qiniup.com',\n        cdnUphost: 'upload-na0.qiniup.com'\n    },\n    _a[region.as0] = {\n        srcUphost: 'up-as0.qiniup.com',\n        cdnUphost: 'upload-as0.qiniup.com'\n    },\n    _a);\n//# sourceMappingURL=config.js.map","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport * as utils from './utils';\nimport { regionUphostMap } from './config';\nimport { urlSafeBase64Encode } from './base64';\nexport function getUpHosts(token, protocol) {\n    return __awaiter(this, void 0, void 0, function () {\n        var putPolicy, url;\n        return __generator(this, function (_a) {\n            putPolicy = utils.getPutPolicy(token);\n            url = protocol + '//api.qiniu.com/v2/query?ak=' + putPolicy.ak + '&bucket=' + putPolicy.bucket;\n            return [2 /*return*/, utils.request(url, { method: 'GET' })];\n        });\n    });\n}\n/** 获取上传url */\nexport function getUploadUrl(config, token) {\n    return __awaiter(this, void 0, void 0, function () {\n        var protocol, upHosts, host, res, hosts;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    protocol = config.upprotocol;\n                    if (config.uphost) {\n                        return [2 /*return*/, protocol + \"//\" + config.uphost];\n                    }\n                    if (config.region) {\n                        upHosts = regionUphostMap[config.region];\n                        host = config.useCdnDomain ? upHosts.cdnUphost : upHosts.srcUphost;\n                        return [2 /*return*/, protocol + \"//\" + host];\n                    }\n                    return [4 /*yield*/, getUpHosts(token, protocol)];\n                case 1:\n                    res = _a.sent();\n                    hosts = res.data.up.acc.main;\n                    return [2 /*return*/, protocol + \"//\" + hosts[0]];\n            }\n        });\n    });\n}\n/**\n * @param bucket 空间名\n * @param key 目标文件名\n * @param uploadInfo 上传信息\n */\nfunction getBaseUrl(bucket, key, uploadInfo) {\n    var url = uploadInfo.url, id = uploadInfo.id;\n    return url + \"/buckets/\" + bucket + \"/objects/\" + (key != null ? urlSafeBase64Encode(key) : '~') + \"/uploads/\" + id;\n}\n/**\n * @param token 上传鉴权凭证\n * @param bucket 上传空间\n * @param key 目标文件名\n * @param uploadUrl 上传地址\n */\nexport function initUploadParts(token, bucket, key, uploadUrl) {\n    var url = uploadUrl + \"/buckets/\" + bucket + \"/objects/\" + (key != null ? urlSafeBase64Encode(key) : '~') + \"/uploads\";\n    return utils.request(url, {\n        method: 'POST',\n        headers: utils.getAuthHeaders(token)\n    });\n}\n/**\n * @param token 上传鉴权凭证\n * @param index 当前 chunk 的索引\n * @param uploadInfo 上传信息\n * @param options 请求参数\n */\nexport function uploadChunk(token, key, index, uploadInfo, options) {\n    var bucket = utils.getPutPolicy(token).bucket;\n    var url = getBaseUrl(bucket, key, uploadInfo) + (\"/\" + index);\n    return utils.request(url, __assign(__assign({}, options), { method: 'PUT', headers: utils.getHeadersForChunkUpload(token) }));\n}\n/**\n * @param token 上传鉴权凭证\n * @param key 目标文件名\n * @param uploadInfo 上传信息\n * @param options 请求参数\n */\nexport function uploadComplete(token, key, uploadInfo, options) {\n    var bucket = utils.getPutPolicy(token).bucket;\n    var url = getBaseUrl(bucket, key, uploadInfo);\n    return utils.request(url, __assign(__assign({}, options), { method: 'POST', headers: utils.getHeadersForMkFile(token) }));\n}\n/**\n * @param token 上传鉴权凭证\n * @param key 目标文件名\n * @param uploadInfo 上传信息\n */\nexport function deleteUploadedChunks(token, key, uploadinfo) {\n    var bucket = utils.getPutPolicy(token).bucket;\n    var url = getBaseUrl(bucket, key, uploadinfo);\n    return utils.request(url, {\n        method: 'DELETE',\n        headers: utils.getAuthHeaders(token)\n    });\n}\n//# sourceMappingURL=api.js.map","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport * as utils from '../utils';\nimport { getUploadUrl } from '../api';\nexport var DEFAULT_CHUNK_SIZE = 4; // 单位 MB\nvar GB = Math.pow(1024, 3);\nvar Base = /** @class */ (function () {\n    function Base(options, handlers, statisticsLogger) {\n        this.statisticsLogger = statisticsLogger;\n        this.xhrList = [];\n        this.aborted = false;\n        this.retryCount = 0;\n        this.config = __assign({ useCdnDomain: true, disableStatisticsReport: false, retryCount: 3, checkByMD5: false, uphost: '', upprotocol: 'https:', forceDirect: false, chunkSize: DEFAULT_CHUNK_SIZE, concurrentRequestLimit: 3 }, options.config);\n        this.putExtra = __assign({ fname: '' }, options.putExtra);\n        this.file = options.file;\n        this.key = options.key;\n        this.token = options.token;\n        this.onData = handlers.onData;\n        this.onError = handlers.onError;\n        this.onComplete = handlers.onComplete;\n        try {\n            this.bucket = utils.getPutPolicy(this.token).bucket;\n        }\n        catch (e) {\n            this.onError(e);\n        }\n    }\n    Base.prototype.putFile = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var err, err, err, _a, result, err_1, reqId, code, needRetry, notReachRetryCount;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        this.aborted = false;\n                        if (!this.putExtra.fname) {\n                            this.putExtra.fname = this.file.name;\n                        }\n                        if (this.file.size > 10000 * GB) {\n                            err = new Error('file size exceed maximum value 10000G');\n                            this.onError(err);\n                            throw err;\n                        }\n                        if (this.putExtra.customVars) {\n                            if (!utils.isCustomVarsValid(this.putExtra.customVars)) {\n                                err = new Error('customVars key should start width x:');\n                                this.onError(err);\n                                throw err;\n                            }\n                        }\n                        if (this.putExtra.metadata) {\n                            if (!utils.isMetaDataValid(this.putExtra.metadata)) {\n                                err = new Error('metadata key should start with x-qn-meta-');\n                                this.onError(err);\n                                throw err;\n                            }\n                        }\n                        _b.label = 1;\n                    case 1:\n                        _b.trys.push([1, 4, , 5]);\n                        _a = this;\n                        return [4 /*yield*/, getUploadUrl(this.config, this.token)];\n                    case 2:\n                        _a.uploadUrl = _b.sent();\n                        this.uploadAt = new Date().getTime();\n                        return [4 /*yield*/, this.run()];\n                    case 3:\n                        result = _b.sent();\n                        this.onComplete(result.data);\n                        if (!this.config.disableStatisticsReport) {\n                            this.sendLog(result.reqId, 200);\n                        }\n                        return [2 /*return*/, result];\n                    case 4:\n                        err_1 = _b.sent();\n                        this.clear();\n                        if (err_1.isRequestError && !this.config.disableStatisticsReport) {\n                            reqId = this.aborted ? '' : err_1.reqId;\n                            code = this.aborted ? -2 : err_1.code;\n                            this.sendLog(reqId, code);\n                        }\n                        needRetry = err_1.isRequestError && err_1.code === 0 && !this.aborted;\n                        notReachRetryCount = ++this.retryCount <= this.config.retryCount;\n                        // 以下条件满足其中之一则会进行重新上传：\n                        // 1. 满足 needRetry 的条件且 retryCount 不为 0\n                        // 2. uploadId 无效时在 resume 里会清除本地数据，并且这里触发重新上传\n                        if (needRetry && notReachRetryCount || err_1.code === 612) {\n                            return [2 /*return*/, this.putFile()];\n                        }\n                        this.onError(err_1);\n                        throw err_1;\n                    case 5: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    Base.prototype.clear = function () {\n        this.xhrList.forEach(function (xhr) { return xhr.abort(); });\n        this.xhrList = [];\n    };\n    Base.prototype.stop = function () {\n        this.clear();\n        this.aborted = true;\n    };\n    Base.prototype.addXhr = function (xhr) {\n        this.xhrList.push(xhr);\n    };\n    Base.prototype.sendLog = function (reqId, code) {\n        this.statisticsLogger.log({\n            code: code,\n            reqId: reqId,\n            host: utils.getDomainFromUrl(this.uploadUrl),\n            remoteIp: '',\n            port: utils.getPortFromUrl(this.uploadUrl),\n            duration: (new Date().getTime() - this.uploadAt) / 1000,\n            time: Math.floor(this.uploadAt / 1000),\n            bytesSent: this.progress ? this.progress.total.loaded : 0,\n            upType: 'jssdk-h5',\n            size: this.file.size\n        }, this.token);\n    };\n    Base.prototype.getProgressInfoItem = function (loaded, size) {\n        return {\n            loaded: loaded,\n            size: size,\n            percent: loaded / size * 100\n        };\n    };\n    return Base;\n}());\nexport default Base;\n//# sourceMappingURL=base.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport * as utils from '../utils';\nimport { Pool } from '../pool';\nimport { uploadChunk, uploadComplete, initUploadParts } from '../api';\nimport Base from './base';\n/** 是否为正整数 */\nfunction isPositiveInteger(n) {\n    var re = /^[1-9]\\d*$/;\n    return re.test(String(n));\n}\nvar Resume = /** @class */ (function (_super) {\n    __extends(Resume, _super);\n    function Resume() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Resume.prototype.run = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var pool, uploadChunks, result;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!this.config.chunkSize || !isPositiveInteger(this.config.chunkSize)) {\n                            throw new Error('chunkSize must be a positive integer');\n                        }\n                        if (this.config.chunkSize > 1024) {\n                            throw new Error('chunkSize maximum value is 1024');\n                        }\n                        return [4 /*yield*/, this.initBeforeUploadChunks()];\n                    case 1:\n                        _a.sent();\n                        pool = new Pool(function (chunkInfo) { return _this.uploadChunk(chunkInfo); }, this.config.concurrentRequestLimit);\n                        uploadChunks = this.chunks.map(function (chunk, index) { return pool.enqueue({ chunk: chunk, index: index }); });\n                        result = Promise.all(uploadChunks).then(function () { return _this.mkFileReq(); });\n                        result.then(function () {\n                            utils.removeLocalFileInfo(_this.getLocalKey());\n                        }, function (err) {\n                            // uploadId 无效，上传参数有误（多由于本地存储信息的 uploadId 失效\n                            if (err.code === 612 || err.code === 400) {\n                                utils.removeLocalFileInfo(_this.getLocalKey());\n                            }\n                        });\n                        return [2 /*return*/, result];\n                }\n            });\n        });\n    };\n    Resume.prototype.uploadChunk = function (chunkInfo) {\n        return __awaiter(this, void 0, void 0, function () {\n            var index, chunk, info, shouldCheckMD5, reuseSaved, md5, onProgress, requestOptions, response;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        index = chunkInfo.index, chunk = chunkInfo.chunk;\n                        info = this.uploadedList[index];\n                        shouldCheckMD5 = this.config.checkByMD5;\n                        reuseSaved = function () {\n                            _this.updateChunkProgress(chunk.size, index);\n                        };\n                        if (info && !shouldCheckMD5) {\n                            reuseSaved();\n                            return [2 /*return*/];\n                        }\n                        return [4 /*yield*/, utils.computeMd5(chunk)];\n                    case 1:\n                        md5 = _a.sent();\n                        if (info && md5 === info.md5) {\n                            reuseSaved();\n                            return [2 /*return*/];\n                        }\n                        onProgress = function (data) {\n                            _this.updateChunkProgress(data.loaded, index);\n                        };\n                        requestOptions = {\n                            body: chunk,\n                            onProgress: onProgress,\n                            onCreate: function (xhr) { return _this.addXhr(xhr); }\n                        };\n                        return [4 /*yield*/, uploadChunk(this.token, this.key, chunkInfo.index + 1, this.getUploadInfo(), requestOptions)\n                            // 在某些浏览器环境下，xhr 的 progress 事件无法被触发，progress 为 null，这里在每次分片上传完成后都手动更新下 progress\n                        ];\n                    case 2:\n                        response = _a.sent();\n                        // 在某些浏览器环境下，xhr 的 progress 事件无法被触发，progress 为 null，这里在每次分片上传完成后都手动更新下 progress\n                        onProgress({\n                            loaded: chunk.size,\n                            total: chunk.size\n                        });\n                        this.uploadedList[index] = {\n                            etag: response.data.etag,\n                            md5: response.data.md5,\n                            size: chunk.size\n                        };\n                        utils.setLocalFileInfo(this.getLocalKey(), {\n                            id: this.uploadId,\n                            data: this.uploadedList\n                        });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    Resume.prototype.mkFileReq = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var data, result;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        data = __assign(__assign(__assign({ parts: this.uploadedList.map(function (value, index) { return ({\n                                etag: value.etag,\n                                partNumber: index + 1\n                            }); }), fname: this.putExtra.fname }, this.putExtra.mimeType && { mimeType: this.putExtra.mimeType }), this.putExtra.customVars && { customVars: this.putExtra.customVars }), this.putExtra.metadata && { metadata: this.putExtra.metadata });\n                        return [4 /*yield*/, uploadComplete(this.token, this.key, this.getUploadInfo(), {\n                                onCreate: function (xhr) { return _this.addXhr(xhr); },\n                                body: JSON.stringify(data)\n                            })];\n                    case 1:\n                        result = _a.sent();\n                        this.updateMkFileProgress(1);\n                        return [2 /*return*/, result];\n                }\n            });\n        });\n    };\n    Resume.prototype.initBeforeUploadChunks = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var localInfo, res;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        localInfo = utils.getLocalFileInfo(this.getLocalKey());\n                        if (!!localInfo) return [3 /*break*/, 2];\n                        // 防止本地信息已被破坏，初始化时 clear 一下\n                        utils.removeLocalFileInfo(this.getLocalKey());\n                        return [4 /*yield*/, initUploadParts(this.token, this.bucket, this.key, this.uploadUrl)];\n                    case 1:\n                        res = _a.sent();\n                        this.uploadId = res.data.uploadId;\n                        this.uploadedList = [];\n                        return [3 /*break*/, 3];\n                    case 2:\n                        this.uploadId = localInfo.id;\n                        this.uploadedList = localInfo.data;\n                        _a.label = 3;\n                    case 3:\n                        this.chunks = utils.getChunks(this.file, this.config.chunkSize);\n                        this.loaded = {\n                            mkFileProgress: 0,\n                            chunks: this.chunks.map(function (_) { return 0; })\n                        };\n                        this.notifyResumeProgress();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    Resume.prototype.getUploadInfo = function () {\n        return {\n            id: this.uploadId,\n            url: this.uploadUrl\n        };\n    };\n    Resume.prototype.getLocalKey = function () {\n        return utils.createLocalKey(this.file.name, this.key, this.file.size);\n    };\n    Resume.prototype.updateChunkProgress = function (loaded, index) {\n        this.loaded.chunks[index] = loaded;\n        this.notifyResumeProgress();\n    };\n    Resume.prototype.updateMkFileProgress = function (progress) {\n        this.loaded.mkFileProgress = progress;\n        this.notifyResumeProgress();\n    };\n    Resume.prototype.notifyResumeProgress = function () {\n        var _this = this;\n        this.progress = {\n            total: this.getProgressInfoItem(utils.sum(this.loaded.chunks) + this.loaded.mkFileProgress, this.file.size + 1 // 防止在 complete 未调用的时候进度显示 100%\n            ),\n            chunks: this.chunks.map(function (chunk, index) { return (_this.getProgressInfoItem(_this.loaded.chunks[index], chunk.size)); }),\n            uploadInfo: {\n                id: this.uploadId,\n                url: this.uploadUrl\n            }\n        };\n        this.onData(this.progress);\n    };\n    return Resume;\n}(Base));\nexport default Resume;\n//# sourceMappingURL=resume.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { request } from '../utils';\nimport Base from './base';\nvar Direct = /** @class */ (function (_super) {\n    __extends(Direct, _super);\n    function Direct() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Direct.prototype.run = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var formData, customVars_1, result;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        formData = new FormData();\n                        formData.append('file', this.file);\n                        formData.append('token', this.token);\n                        if (this.key != null) {\n                            formData.append('key', this.key);\n                        }\n                        formData.append('fname', this.putExtra.fname);\n                        if (this.putExtra.customVars) {\n                            customVars_1 = this.putExtra.customVars;\n                            Object.keys(customVars_1).forEach(function (key) { return formData.append(key, customVars_1[key].toString()); });\n                        }\n                        return [4 /*yield*/, request(this.uploadUrl, {\n                                method: 'POST',\n                                body: formData,\n                                onProgress: function (data) {\n                                    _this.updateDirectProgress(data.loaded, data.total);\n                                },\n                                onCreate: function (xhr) { return _this.addXhr(xhr); }\n                            })];\n                    case 1:\n                        result = _a.sent();\n                        this.finishDirectProgress();\n                        return [2 /*return*/, result];\n                }\n            });\n        });\n    };\n    Direct.prototype.updateDirectProgress = function (loaded, total) {\n        // 当请求未完成时可能进度会达到100，所以total + 1来防止这种情况出现\n        this.progress = { total: this.getProgressInfoItem(loaded, total + 1) };\n        this.onData(this.progress);\n    };\n    Direct.prototype.finishDirectProgress = function () {\n        // 在某些浏览器环境下，xhr 的 progress 事件无法被触发，progress 为 null，这里 fake 下\n        if (!this.progress) {\n            this.progress = { total: this.getProgressInfoItem(this.file.size, this.file.size) };\n            this.onData(this.progress);\n            return;\n        }\n        var total = this.progress.total;\n        this.progress = { total: this.getProgressInfoItem(total.loaded + 1, total.size) };\n        this.onData(this.progress);\n    };\n    return Direct;\n}(Base));\nexport default Direct;\n//# sourceMappingURL=direct.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\n/** 表示可清理的资源，比如 Observable 的执行 */\nvar Subscription = /** @class */ (function () {\n    function Subscription() {\n        /** 用来标示该 Subscription 是否被取消订阅的标示位 */\n        this.closed = false;\n    }\n    /** 取消 observer 的订阅 */\n    Subscription.prototype.unsubscribe = function () {\n        if (this.closed) {\n            return;\n        }\n        this.closed = true;\n        if (this._unsubscribe) {\n            this._unsubscribe();\n        }\n    };\n    /** 添加一个 tear down 在该 Subscription 的 unsubscribe() 期间调用 */\n    Subscription.prototype.add = function (teardown) {\n        this._unsubscribe = teardown;\n    };\n    return Subscription;\n}());\n/**\n * 实现 Observer 接口并且继承 Subscription 类，Observer 是消费 Observable 值的公有 API\n * 所有 Observers 都转化成了 Subscriber，以便提供类似 Subscription 的能力，比如 unsubscribe\n*/\nvar Subscriber = /** @class */ (function (_super) {\n    __extends(Subscriber, _super);\n    function Subscriber(observerOrNext, error, complete) {\n        var _this = _super.call(this) || this;\n        _this.isStopped = false;\n        if (observerOrNext && typeof observerOrNext === 'object') {\n            _this.destination = observerOrNext;\n        }\n        else {\n            _this.destination = __assign(__assign(__assign({}, observerOrNext && { next: observerOrNext }), error && { error: error }), complete && { complete: complete });\n        }\n        return _this;\n    }\n    Subscriber.prototype.unsubscribe = function () {\n        if (this.closed) {\n            return;\n        }\n        this.isStopped = true;\n        _super.prototype.unsubscribe.call(this);\n    };\n    Subscriber.prototype.next = function (value) {\n        if (!this.isStopped && this.destination.next) {\n            this.destination.next(value);\n        }\n    };\n    Subscriber.prototype.error = function (err) {\n        if (!this.isStopped && this.destination.error) {\n            this.isStopped = true;\n            this.destination.error(err);\n        }\n    };\n    Subscriber.prototype.complete = function (result) {\n        if (!this.isStopped && this.destination.complete) {\n            this.isStopped = true;\n            this.destination.complete(result);\n        }\n    };\n    return Subscriber;\n}(Subscription));\nexport { Subscriber };\n/** 可观察对象，当前的上传事件的集合 */\nvar Observable = /** @class */ (function () {\n    function Observable(_subscribe) {\n        this._subscribe = _subscribe;\n    }\n    Observable.prototype.subscribe = function (observerOrNext, error, complete) {\n        var sink = new Subscriber(observerOrNext, error, complete);\n        sink.add(this._subscribe(sink));\n        return sink;\n    };\n    return Observable;\n}());\nexport { Observable };\n//# sourceMappingURL=observable.js.map","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spread = (this && this.__spread) || function () {\n    for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n    return ar;\n};\nimport { EXIF } from 'exif-js';\nimport { createObjectURL, getTransform } from './utils';\nvar mimeTypes = {\n    PNG: 'image/png',\n    JPEG: 'image/jpeg',\n    WEBP: 'image/webp',\n    BMP: 'image/bmp'\n};\nvar maxSteps = 4;\nvar scaleFactor = Math.log(2);\nvar supportMimeTypes = Object.keys(mimeTypes).map(function (type) { return mimeTypes[type]; });\nvar defaultType = mimeTypes.JPEG;\nfunction isSupportedType(type) {\n    return supportMimeTypes.includes(type);\n}\nvar Compress = /** @class */ (function () {\n    function Compress(file, config) {\n        this.file = file;\n        this.config = config;\n        this.config = __assign({ quality: 0.92, noCompressIfLarger: false }, this.config);\n    }\n    Compress.prototype.process = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var srcDimension, originImage, canvas, scale, scaleCanvas, distBlob;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.outputType = this.file.type;\n                        srcDimension = {};\n                        if (!isSupportedType(this.file.type)) {\n                            throw new Error(\"unsupported file type: \" + this.file.type);\n                        }\n                        return [4 /*yield*/, this.getOriginImage()];\n                    case 1:\n                        originImage = _a.sent();\n                        return [4 /*yield*/, this.getCanvas(originImage)];\n                    case 2:\n                        canvas = _a.sent();\n                        scale = 1;\n                        if (this.config.maxWidth) {\n                            scale = Math.min(1, this.config.maxWidth / canvas.width);\n                        }\n                        if (this.config.maxHeight) {\n                            scale = Math.min(1, scale, this.config.maxHeight / canvas.height);\n                        }\n                        srcDimension.width = canvas.width;\n                        srcDimension.height = canvas.height;\n                        return [4 /*yield*/, this.doScale(canvas, scale)];\n                    case 3:\n                        scaleCanvas = _a.sent();\n                        distBlob = this.toBlob(scaleCanvas);\n                        if (distBlob.size > this.file.size && this.config.noCompressIfLarger) {\n                            return [2 /*return*/, {\n                                    dist: this.file,\n                                    width: srcDimension.width,\n                                    height: srcDimension.height\n                                }];\n                        }\n                        return [2 /*return*/, {\n                                dist: distBlob,\n                                width: scaleCanvas.width,\n                                height: scaleCanvas.height\n                            }];\n                }\n            });\n        });\n    };\n    Compress.prototype.clear = function (ctx, width, height) {\n        // jpeg 没有 alpha 通道，透明区间会被填充成黑色，这里把透明区间填充为白色\n        if (this.outputType === defaultType) {\n            ctx.fillStyle = '#fff';\n            ctx.fillRect(0, 0, width, height);\n        }\n        else {\n            ctx.clearRect(0, 0, width, height);\n        }\n    };\n    /** 通过 file 初始化 image 对象 */\n    Compress.prototype.getOriginImage = function () {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            var url = createObjectURL(_this.file);\n            var img = new Image();\n            img.onload = function () {\n                resolve(img);\n            };\n            img.onerror = function () {\n                reject('image load error');\n            };\n            img.src = url;\n        });\n    };\n    Compress.prototype.getCanvas = function (img) {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            // 通过得到图片的信息来调整显示方向以正确显示图片，主要解决 ios 系统上的图片会有旋转的问题\n            EXIF.getData(img, function () {\n                var orientation = EXIF.getTag(img, 'Orientation') || 1;\n                var _a = getTransform(img, orientation), width = _a.width, height = _a.height, matrix = _a.matrix;\n                var canvas = document.createElement('canvas');\n                var context = canvas.getContext('2d');\n                canvas.width = width;\n                canvas.height = height;\n                if (!context) {\n                    reject(new Error('context is null'));\n                    return;\n                }\n                _this.clear(context, width, height);\n                context.transform.apply(context, __spread(matrix));\n                context.drawImage(img, 0, 0);\n                resolve(canvas);\n            });\n        });\n    };\n    Compress.prototype.doScale = function (source, scale) {\n        return __awaiter(this, void 0, void 0, function () {\n            var sctx, steps, factor, mirror, mctx, width, height, originWidth, originHeight, src, context, i, dw, dh, canvas, data;\n            return __generator(this, function (_a) {\n                if (scale === 1) {\n                    return [2 /*return*/, source];\n                }\n                sctx = source.getContext('2d');\n                steps = Math.min(maxSteps, Math.ceil((1 / scale) / scaleFactor));\n                factor = Math.pow(scale, (1 / steps));\n                mirror = document.createElement('canvas');\n                mctx = mirror.getContext('2d');\n                width = source.width, height = source.height;\n                originWidth = width;\n                originHeight = height;\n                mirror.width = width;\n                mirror.height = height;\n                if (!mctx || !sctx) {\n                    throw new Error(\"mctx or sctx can't be null\");\n                }\n                for (i = 0; i < steps; i++) {\n                    dw = width * factor | 0 // eslint-disable-line no-bitwise\n                    ;\n                    dh = height * factor | 0 // eslint-disable-line no-bitwise\n                    ;\n                    // 到最后一步的时候 dw, dh 用目标缩放尺寸，否则会出现最后尺寸偏小的情况\n                    if (i === steps - 1) {\n                        dw = originWidth * scale;\n                        dh = originHeight * scale;\n                    }\n                    if (i % 2 === 0) {\n                        src = source;\n                        context = mctx;\n                    }\n                    else {\n                        src = mirror;\n                        context = sctx;\n                    }\n                    // 每次画前都清空，避免图像重叠\n                    this.clear(context, width, height);\n                    context.drawImage(src, 0, 0, width, height, 0, 0, dw, dh);\n                    width = dw;\n                    height = dh;\n                }\n                canvas = src === source ? mirror : source;\n                data = context.getImageData(0, 0, width, height);\n                // resize\n                canvas.width = width;\n                canvas.height = height;\n                // store image data\n                context.putImageData(data, 0, 0);\n                return [2 /*return*/, canvas];\n            });\n        });\n    };\n    /** 这里把 base64 字符串转为 blob 对象 */\n    Compress.prototype.toBlob = function (result) {\n        var dataURL = result.toDataURL(this.outputType, this.config.quality);\n        var buffer = atob(dataURL.split(',')[1]).split('').map(function (char) { return char.charCodeAt(0); });\n        var blob = new Blob([new Uint8Array(buffer)], { type: this.outputType });\n        return blob;\n    };\n    return Compress;\n}());\nvar compressImage = function (file, options) { return new Compress(file, options).process(); };\nexport default compressImage;\n//# sourceMappingURL=compress.js.map","import StatisticsLogger from './statisticsLog';\nimport createUploadManager from './upload';\nimport { Observable } from './observable';\nimport compressImage from './compress';\nvar statisticsLogger = new StatisticsLogger();\n/**\n * @param file 上传文件\n * @param key 目标文件名\n * @param token 上传凭证\n * @param putExtra 上传文件的相关资源信息配置\n * @param config 上传任务的配置\n * @returns 返回用于上传任务的可观察对象\n */\nfunction upload(file, key, token, putExtra, config) {\n    var options = {\n        file: file,\n        key: key,\n        token: token,\n        putExtra: putExtra,\n        config: config\n    };\n    return new Observable(function (observer) {\n        var manager = createUploadManager(options, {\n            onData: function (data) { return observer.next(data); },\n            onError: function (err) { return observer.error(err); },\n            onComplete: function (res) { return observer.complete(res); }\n        }, statisticsLogger);\n        manager.putFile();\n        return manager.stop.bind(manager);\n    });\n}\nexport { getHeadersForMkFile, getHeadersForChunkUpload } from './utils';\nexport { urlSafeBase64Encode, urlSafeBase64Decode } from './base64';\nexport { deleteUploadedChunks, getUploadUrl } from './api';\nexport { imageMogr2, watermark, imageInfo, exif, pipeline } from './image';\nexport { region } from './config';\nexport { upload, compressImage };\n//# sourceMappingURL=index.js.map","import Resume from './resume';\nimport Direct from './direct';\nimport { MB } from '../utils';\nexport * from './base';\nexport * from './resume';\nexport default function createUploadManager(options, handlers, statisticsLogger) {\n    if (options.config && options.config.forceDirect) {\n        return new Direct(options, handlers, statisticsLogger);\n    }\n    return options.file.size > 4 * MB\n        ? new Resume(options, handlers, statisticsLogger)\n        : new Direct(options, handlers, statisticsLogger);\n}\n//# sourceMappingURL=index.js.map","(function (factory) {\n    if (typeof exports === 'object') {\n        // Node/CommonJS\n        module.exports = factory();\n    } else if (typeof define === 'function' && define.amd) {\n        // AMD\n        define(factory);\n    } else {\n        // Browser globals (with support for web workers)\n        var glob;\n\n        try {\n            glob = window;\n        } catch (e) {\n            glob = self;\n        }\n\n        glob.SparkMD5 = factory();\n    }\n}(function (undefined) {\n\n    'use strict';\n\n    /*\n     * Fastest md5 implementation around (JKM md5).\n     * Credits: Joseph Myers\n     *\n     * @see http://www.myersdaily.org/joseph/javascript/md5-text.html\n     * @see http://jsperf.com/md5-shootout/7\n     */\n\n    /* this function is much faster,\n      so if possible we use it. Some IEs\n      are the only ones I know of that\n      need the idiotic second function,\n      generated by an if clause.  */\n    var add32 = function (a, b) {\n        return (a + b) & 0xFFFFFFFF;\n    },\n        hex_chr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'];\n\n\n    function cmn(q, a, b, x, s, t) {\n        a = add32(add32(a, q), add32(x, t));\n        return add32((a << s) | (a >>> (32 - s)), b);\n    }\n\n    function md5cycle(x, k) {\n        var a = x[0],\n            b = x[1],\n            c = x[2],\n            d = x[3];\n\n        a += (b & c | ~b & d) + k[0] - 680876936 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[1] - 389564586 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[2] + 606105819 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[3] - 1044525330 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[4] - 176418897 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[5] + 1200080426 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[6] - 1473231341 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[7] - 45705983 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[8] + 1770035416 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[9] - 1958414417 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[10] - 42063 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[11] - 1990404162 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[12] + 1804603682 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[13] - 40341101 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[14] - 1502002290 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[15] + 1236535329 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n\n        a += (b & d | c & ~d) + k[1] - 165796510 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[6] - 1069501632 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[11] + 643717713 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[0] - 373897302 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[5] - 701558691 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[10] + 38016083 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[15] - 660478335 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[4] - 405537848 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[9] + 568446438 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[14] - 1019803690 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[3] - 187363961 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[8] + 1163531501 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[13] - 1444681467 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[2] - 51403784 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[7] + 1735328473 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[12] - 1926607734 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n\n        a += (b ^ c ^ d) + k[5] - 378558 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[8] - 2022574463 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[11] + 1839030562 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[14] - 35309556 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[1] - 1530992060 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[4] + 1272893353 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[7] - 155497632 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[10] - 1094730640 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[13] + 681279174 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[0] - 358537222 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[3] - 722521979 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[6] + 76029189 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[9] - 640364487 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[12] - 421815835 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[15] + 530742520 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[2] - 995338651 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n\n        a += (c ^ (b | ~d)) + k[0] - 198630844 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[7] + 1126891415 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[14] - 1416354905 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[5] - 57434055 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[12] + 1700485571 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[3] - 1894986606 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[10] - 1051523 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[1] - 2054922799 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[8] + 1873313359 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[15] - 30611744 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[6] - 1560198380 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[13] + 1309151649 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[4] - 145523070 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[11] - 1120210379 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[2] + 718787259 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[9] - 343485551 | 0;\n        b  = (b << 21 | b >>> 11) + c | 0;\n\n        x[0] = a + x[0] | 0;\n        x[1] = b + x[1] | 0;\n        x[2] = c + x[2] | 0;\n        x[3] = d + x[3] | 0;\n    }\n\n    function md5blk(s) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = s.charCodeAt(i) + (s.charCodeAt(i + 1) << 8) + (s.charCodeAt(i + 2) << 16) + (s.charCodeAt(i + 3) << 24);\n        }\n        return md5blks;\n    }\n\n    function md5blk_array(a) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = a[i] + (a[i + 1] << 8) + (a[i + 2] << 16) + (a[i + 3] << 24);\n        }\n        return md5blks;\n    }\n\n    function md51(s) {\n        var n = s.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk(s.substring(i - 64, i)));\n        }\n        s = s.substring(i - 64);\n        length = s.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);\n        }\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n        return state;\n    }\n\n    function md51_array(a) {\n        var n = a.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk_array(a.subarray(i - 64, i)));\n        }\n\n        // Not sure if it is a bug, however IE10 will always produce a sub array of length 1\n        // containing the last element of the parent array if the sub array specified starts\n        // beyond the length of the parent array - weird.\n        // https://connect.microsoft.com/IE/feedback/details/771452/typed-array-subarray-issue\n        a = (i - 64) < n ? a.subarray(i - 64) : new Uint8Array(0);\n\n        length = a.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= a[i] << ((i % 4) << 3);\n        }\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n\n        return state;\n    }\n\n    function rhex(n) {\n        var s = '',\n            j;\n        for (j = 0; j < 4; j += 1) {\n            s += hex_chr[(n >> (j * 8 + 4)) & 0x0F] + hex_chr[(n >> (j * 8)) & 0x0F];\n        }\n        return s;\n    }\n\n    function hex(x) {\n        var i;\n        for (i = 0; i < x.length; i += 1) {\n            x[i] = rhex(x[i]);\n        }\n        return x.join('');\n    }\n\n    // In some cases the fast add32 function cannot be used..\n    if (hex(md51('hello')) !== '5d41402abc4b2a76b9719d911017c592') {\n        add32 = function (x, y) {\n            var lsw = (x & 0xFFFF) + (y & 0xFFFF),\n                msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n            return (msw << 16) | (lsw & 0xFFFF);\n        };\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * ArrayBuffer slice polyfill.\n     *\n     * @see https://github.com/ttaubert/node-arraybuffer-slice\n     */\n\n    if (typeof ArrayBuffer !== 'undefined' && !ArrayBuffer.prototype.slice) {\n        (function () {\n            function clamp(val, length) {\n                val = (val | 0) || 0;\n\n                if (val < 0) {\n                    return Math.max(val + length, 0);\n                }\n\n                return Math.min(val, length);\n            }\n\n            ArrayBuffer.prototype.slice = function (from, to) {\n                var length = this.byteLength,\n                    begin = clamp(from, length),\n                    end = length,\n                    num,\n                    target,\n                    targetArray,\n                    sourceArray;\n\n                if (to !== undefined) {\n                    end = clamp(to, length);\n                }\n\n                if (begin > end) {\n                    return new ArrayBuffer(0);\n                }\n\n                num = end - begin;\n                target = new ArrayBuffer(num);\n                targetArray = new Uint8Array(target);\n\n                sourceArray = new Uint8Array(this, begin, num);\n                targetArray.set(sourceArray);\n\n                return target;\n            };\n        })();\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * Helpers.\n     */\n\n    function toUtf8(str) {\n        if (/[\\u0080-\\uFFFF]/.test(str)) {\n            str = unescape(encodeURIComponent(str));\n        }\n\n        return str;\n    }\n\n    function utf8Str2ArrayBuffer(str, returnUInt8Array) {\n        var length = str.length,\n           buff = new ArrayBuffer(length),\n           arr = new Uint8Array(buff),\n           i;\n\n        for (i = 0; i < length; i += 1) {\n            arr[i] = str.charCodeAt(i);\n        }\n\n        return returnUInt8Array ? arr : buff;\n    }\n\n    function arrayBuffer2Utf8Str(buff) {\n        return String.fromCharCode.apply(null, new Uint8Array(buff));\n    }\n\n    function concatenateArrayBuffers(first, second, returnUInt8Array) {\n        var result = new Uint8Array(first.byteLength + second.byteLength);\n\n        result.set(new Uint8Array(first));\n        result.set(new Uint8Array(second), first.byteLength);\n\n        return returnUInt8Array ? result : result.buffer;\n    }\n\n    function hexToBinaryString(hex) {\n        var bytes = [],\n            length = hex.length,\n            x;\n\n        for (x = 0; x < length - 1; x += 2) {\n            bytes.push(parseInt(hex.substr(x, 2), 16));\n        }\n\n        return String.fromCharCode.apply(String, bytes);\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation.\n     *\n     * Use this class to perform an incremental md5, otherwise use the\n     * static methods instead.\n     */\n\n    function SparkMD5() {\n        // call reset to init the instance\n        this.reset();\n    }\n\n    /**\n     * Appends a string.\n     * A conversion will be applied if an utf8 string is detected.\n     *\n     * @param {String} str The string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.append = function (str) {\n        // Converts the string to utf8 bytes if necessary\n        // Then append as binary\n        this.appendBinary(toUtf8(str));\n\n        return this;\n    };\n\n    /**\n     * Appends a binary string.\n     *\n     * @param {String} contents The binary string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.appendBinary = function (contents) {\n        this._buff += contents;\n        this._length += contents.length;\n\n        var length = this._buff.length,\n            i;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk(this._buff.substring(i - 64, i)));\n        }\n\n        this._buff = this._buff.substring(i - 64);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            i,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff.charCodeAt(i) << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.reset = function () {\n        this._buff = '';\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.prototype.getState = function () {\n        return {\n            buff: this._buff,\n            length: this._length,\n            hash: this._hash.slice()\n        };\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.setState = function (state) {\n        this._buff = state.buff;\n        this._length = state.length;\n        this._hash = state.hash;\n\n        return this;\n    };\n\n    /**\n     * Releases memory used by the incremental buffer and other additional\n     * resources. If you plan to use the instance again, use reset instead.\n     */\n    SparkMD5.prototype.destroy = function () {\n        delete this._hash;\n        delete this._buff;\n        delete this._length;\n    };\n\n    /**\n     * Finish the final calculation based on the tail.\n     *\n     * @param {Array}  tail   The tail (will be modified)\n     * @param {Number} length The length of the remaining buffer\n     */\n    SparkMD5.prototype._finish = function (tail, length) {\n        var i = length,\n            tmp,\n            lo,\n            hi;\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(this._hash, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Do the final computation based on the tail and length\n        // Beware that the final length may not fit in 32 bits so we take care of that\n        tmp = this._length * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n        md5cycle(this._hash, tail);\n    };\n\n    /**\n     * Performs the md5 hash on a string.\n     * A conversion will be applied if utf8 string is detected.\n     *\n     * @param {String}  str The string\n     * @param {Boolean} [raw] True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hash = function (str, raw) {\n        // Converts the string to utf8 bytes if necessary\n        // Then compute it using the binary function\n        return SparkMD5.hashBinary(toUtf8(str), raw);\n    };\n\n    /**\n     * Performs the md5 hash on a binary string.\n     *\n     * @param {String}  content The binary string\n     * @param {Boolean} [raw]     True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hashBinary = function (content, raw) {\n        var hash = md51(content),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation for array buffers.\n     *\n     * Use this class to perform an incremental md5 ONLY for array buffers.\n     */\n    SparkMD5.ArrayBuffer = function () {\n        // call reset to init the instance\n        this.reset();\n    };\n\n    /**\n     * Appends an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array to be appended\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.append = function (arr) {\n        var buff = concatenateArrayBuffers(this._buff.buffer, arr, true),\n            length = buff.length,\n            i;\n\n        this._length += arr.byteLength;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk_array(buff.subarray(i - 64, i)));\n        }\n\n        this._buff = (i - 64) < length ? new Uint8Array(buff.buffer.slice(i - 64)) : new Uint8Array(0);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            i,\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff[i] << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.reset = function () {\n        this._buff = new Uint8Array(0);\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.ArrayBuffer.prototype.getState = function () {\n        var state = SparkMD5.prototype.getState.call(this);\n\n        // Convert buffer to a string\n        state.buff = arrayBuffer2Utf8Str(state.buff);\n\n        return state;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.setState = function (state) {\n        // Convert string to buffer\n        state.buff = utf8Str2ArrayBuffer(state.buff, true);\n\n        return SparkMD5.prototype.setState.call(this, state);\n    };\n\n    SparkMD5.ArrayBuffer.prototype.destroy = SparkMD5.prototype.destroy;\n\n    SparkMD5.ArrayBuffer.prototype._finish = SparkMD5.prototype._finish;\n\n    /**\n     * Performs the md5 hash on an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array buffer\n     * @param {Boolean}     [raw] True to get the raw string, false to get the hex one\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.hash = function (arr, raw) {\n        var hash = md51_array(new Uint8Array(arr)),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    return SparkMD5;\n}));\n","(function() {\n\n    var debug = false;\n\n    var root = this;\n\n    var EXIF = function(obj) {\n        if (obj instanceof EXIF) return obj;\n        if (!(this instanceof EXIF)) return new EXIF(obj);\n        this.EXIFwrapped = obj;\n    };\n\n    if (typeof exports !== 'undefined') {\n        if (typeof module !== 'undefined' && module.exports) {\n            exports = module.exports = EXIF;\n        }\n        exports.EXIF = EXIF;\n    } else {\n        root.EXIF = EXIF;\n    }\n\n    var ExifTags = EXIF.Tags = {\n\n        // version tags\n        0x9000 : \"ExifVersion\",             // EXIF version\n        0xA000 : \"FlashpixVersion\",         // Flashpix format version\n\n        // colorspace tags\n        0xA001 : \"ColorSpace\",              // Color space information tag\n\n        // image configuration\n        0xA002 : \"PixelXDimension\",         // Valid width of meaningful image\n        0xA003 : \"PixelYDimension\",         // Valid height of meaningful image\n        0x9101 : \"ComponentsConfiguration\", // Information about channels\n        0x9102 : \"CompressedBitsPerPixel\",  // Compressed bits per pixel\n\n        // user information\n        0x927C : \"MakerNote\",               // Any desired information written by the manufacturer\n        0x9286 : \"UserComment\",             // Comments by user\n\n        // related file\n        0xA004 : \"RelatedSoundFile\",        // Name of related sound file\n\n        // date and time\n        0x9003 : \"DateTimeOriginal\",        // Date and time when the original image was generated\n        0x9004 : \"DateTimeDigitized\",       // Date and time when the image was stored digitally\n        0x9290 : \"SubsecTime\",              // Fractions of seconds for DateTime\n        0x9291 : \"SubsecTimeOriginal\",      // Fractions of seconds for DateTimeOriginal\n        0x9292 : \"SubsecTimeDigitized\",     // Fractions of seconds for DateTimeDigitized\n\n        // picture-taking conditions\n        0x829A : \"ExposureTime\",            // Exposure time (in seconds)\n        0x829D : \"FNumber\",                 // F number\n        0x8822 : \"ExposureProgram\",         // Exposure program\n        0x8824 : \"SpectralSensitivity\",     // Spectral sensitivity\n        0x8827 : \"ISOSpeedRatings\",         // ISO speed rating\n        0x8828 : \"OECF\",                    // Optoelectric conversion factor\n        0x9201 : \"ShutterSpeedValue\",       // Shutter speed\n        0x9202 : \"ApertureValue\",           // Lens aperture\n        0x9203 : \"BrightnessValue\",         // Value of brightness\n        0x9204 : \"ExposureBias\",            // Exposure bias\n        0x9205 : \"MaxApertureValue\",        // Smallest F number of lens\n        0x9206 : \"SubjectDistance\",         // Distance to subject in meters\n        0x9207 : \"MeteringMode\",            // Metering mode\n        0x9208 : \"LightSource\",             // Kind of light source\n        0x9209 : \"Flash\",                   // Flash status\n        0x9214 : \"SubjectArea\",             // Location and area of main subject\n        0x920A : \"FocalLength\",             // Focal length of the lens in mm\n        0xA20B : \"FlashEnergy\",             // Strobe energy in BCPS\n        0xA20C : \"SpatialFrequencyResponse\",    //\n        0xA20E : \"FocalPlaneXResolution\",   // Number of pixels in width direction per FocalPlaneResolutionUnit\n        0xA20F : \"FocalPlaneYResolution\",   // Number of pixels in height direction per FocalPlaneResolutionUnit\n        0xA210 : \"FocalPlaneResolutionUnit\",    // Unit for measuring FocalPlaneXResolution and FocalPlaneYResolution\n        0xA214 : \"SubjectLocation\",         // Location of subject in image\n        0xA215 : \"ExposureIndex\",           // Exposure index selected on camera\n        0xA217 : \"SensingMethod\",           // Image sensor type\n        0xA300 : \"FileSource\",              // Image source (3 == DSC)\n        0xA301 : \"SceneType\",               // Scene type (1 == directly photographed)\n        0xA302 : \"CFAPattern\",              // Color filter array geometric pattern\n        0xA401 : \"CustomRendered\",          // Special processing\n        0xA402 : \"ExposureMode\",            // Exposure mode\n        0xA403 : \"WhiteBalance\",            // 1 = auto white balance, 2 = manual\n        0xA404 : \"DigitalZoomRation\",       // Digital zoom ratio\n        0xA405 : \"FocalLengthIn35mmFilm\",   // Equivalent foacl length assuming 35mm film camera (in mm)\n        0xA406 : \"SceneCaptureType\",        // Type of scene\n        0xA407 : \"GainControl\",             // Degree of overall image gain adjustment\n        0xA408 : \"Contrast\",                // Direction of contrast processing applied by camera\n        0xA409 : \"Saturation\",              // Direction of saturation processing applied by camera\n        0xA40A : \"Sharpness\",               // Direction of sharpness processing applied by camera\n        0xA40B : \"DeviceSettingDescription\",    //\n        0xA40C : \"SubjectDistanceRange\",    // Distance to subject\n\n        // other tags\n        0xA005 : \"InteroperabilityIFDPointer\",\n        0xA420 : \"ImageUniqueID\"            // Identifier assigned uniquely to each image\n    };\n\n    var TiffTags = EXIF.TiffTags = {\n        0x0100 : \"ImageWidth\",\n        0x0101 : \"ImageHeight\",\n        0x8769 : \"ExifIFDPointer\",\n        0x8825 : \"GPSInfoIFDPointer\",\n        0xA005 : \"InteroperabilityIFDPointer\",\n        0x0102 : \"BitsPerSample\",\n        0x0103 : \"Compression\",\n        0x0106 : \"PhotometricInterpretation\",\n        0x0112 : \"Orientation\",\n        0x0115 : \"SamplesPerPixel\",\n        0x011C : \"PlanarConfiguration\",\n        0x0212 : \"YCbCrSubSampling\",\n        0x0213 : \"YCbCrPositioning\",\n        0x011A : \"XResolution\",\n        0x011B : \"YResolution\",\n        0x0128 : \"ResolutionUnit\",\n        0x0111 : \"StripOffsets\",\n        0x0116 : \"RowsPerStrip\",\n        0x0117 : \"StripByteCounts\",\n        0x0201 : \"JPEGInterchangeFormat\",\n        0x0202 : \"JPEGInterchangeFormatLength\",\n        0x012D : \"TransferFunction\",\n        0x013E : \"WhitePoint\",\n        0x013F : \"PrimaryChromaticities\",\n        0x0211 : \"YCbCrCoefficients\",\n        0x0214 : \"ReferenceBlackWhite\",\n        0x0132 : \"DateTime\",\n        0x010E : \"ImageDescription\",\n        0x010F : \"Make\",\n        0x0110 : \"Model\",\n        0x0131 : \"Software\",\n        0x013B : \"Artist\",\n        0x8298 : \"Copyright\"\n    };\n\n    var GPSTags = EXIF.GPSTags = {\n        0x0000 : \"GPSVersionID\",\n        0x0001 : \"GPSLatitudeRef\",\n        0x0002 : \"GPSLatitude\",\n        0x0003 : \"GPSLongitudeRef\",\n        0x0004 : \"GPSLongitude\",\n        0x0005 : \"GPSAltitudeRef\",\n        0x0006 : \"GPSAltitude\",\n        0x0007 : \"GPSTimeStamp\",\n        0x0008 : \"GPSSatellites\",\n        0x0009 : \"GPSStatus\",\n        0x000A : \"GPSMeasureMode\",\n        0x000B : \"GPSDOP\",\n        0x000C : \"GPSSpeedRef\",\n        0x000D : \"GPSSpeed\",\n        0x000E : \"GPSTrackRef\",\n        0x000F : \"GPSTrack\",\n        0x0010 : \"GPSImgDirectionRef\",\n        0x0011 : \"GPSImgDirection\",\n        0x0012 : \"GPSMapDatum\",\n        0x0013 : \"GPSDestLatitudeRef\",\n        0x0014 : \"GPSDestLatitude\",\n        0x0015 : \"GPSDestLongitudeRef\",\n        0x0016 : \"GPSDestLongitude\",\n        0x0017 : \"GPSDestBearingRef\",\n        0x0018 : \"GPSDestBearing\",\n        0x0019 : \"GPSDestDistanceRef\",\n        0x001A : \"GPSDestDistance\",\n        0x001B : \"GPSProcessingMethod\",\n        0x001C : \"GPSAreaInformation\",\n        0x001D : \"GPSDateStamp\",\n        0x001E : \"GPSDifferential\"\n    };\n\n     // EXIF 2.3 Spec\n    var IFD1Tags = EXIF.IFD1Tags = {\n        0x0100: \"ImageWidth\",\n        0x0101: \"ImageHeight\",\n        0x0102: \"BitsPerSample\",\n        0x0103: \"Compression\",\n        0x0106: \"PhotometricInterpretation\",\n        0x0111: \"StripOffsets\",\n        0x0112: \"Orientation\",\n        0x0115: \"SamplesPerPixel\",\n        0x0116: \"RowsPerStrip\",\n        0x0117: \"StripByteCounts\",\n        0x011A: \"XResolution\",\n        0x011B: \"YResolution\",\n        0x011C: \"PlanarConfiguration\",\n        0x0128: \"ResolutionUnit\",\n        0x0201: \"JpegIFOffset\",    // When image format is JPEG, this value show offset to JPEG data stored.(aka \"ThumbnailOffset\" or \"JPEGInterchangeFormat\")\n        0x0202: \"JpegIFByteCount\", // When image format is JPEG, this value shows data size of JPEG image (aka \"ThumbnailLength\" or \"JPEGInterchangeFormatLength\")\n        0x0211: \"YCbCrCoefficients\",\n        0x0212: \"YCbCrSubSampling\",\n        0x0213: \"YCbCrPositioning\",\n        0x0214: \"ReferenceBlackWhite\"\n    };\n\n    var StringValues = EXIF.StringValues = {\n        ExposureProgram : {\n            0 : \"Not defined\",\n            1 : \"Manual\",\n            2 : \"Normal program\",\n            3 : \"Aperture priority\",\n            4 : \"Shutter priority\",\n            5 : \"Creative program\",\n            6 : \"Action program\",\n            7 : \"Portrait mode\",\n            8 : \"Landscape mode\"\n        },\n        MeteringMode : {\n            0 : \"Unknown\",\n            1 : \"Average\",\n            2 : \"CenterWeightedAverage\",\n            3 : \"Spot\",\n            4 : \"MultiSpot\",\n            5 : \"Pattern\",\n            6 : \"Partial\",\n            255 : \"Other\"\n        },\n        LightSource : {\n            0 : \"Unknown\",\n            1 : \"Daylight\",\n            2 : \"Fluorescent\",\n            3 : \"Tungsten (incandescent light)\",\n            4 : \"Flash\",\n            9 : \"Fine weather\",\n            10 : \"Cloudy weather\",\n            11 : \"Shade\",\n            12 : \"Daylight fluorescent (D 5700 - 7100K)\",\n            13 : \"Day white fluorescent (N 4600 - 5400K)\",\n            14 : \"Cool white fluorescent (W 3900 - 4500K)\",\n            15 : \"White fluorescent (WW 3200 - 3700K)\",\n            17 : \"Standard light A\",\n            18 : \"Standard light B\",\n            19 : \"Standard light C\",\n            20 : \"D55\",\n            21 : \"D65\",\n            22 : \"D75\",\n            23 : \"D50\",\n            24 : \"ISO studio tungsten\",\n            255 : \"Other\"\n        },\n        Flash : {\n            0x0000 : \"Flash did not fire\",\n            0x0001 : \"Flash fired\",\n            0x0005 : \"Strobe return light not detected\",\n            0x0007 : \"Strobe return light detected\",\n            0x0009 : \"Flash fired, compulsory flash mode\",\n            0x000D : \"Flash fired, compulsory flash mode, return light not detected\",\n            0x000F : \"Flash fired, compulsory flash mode, return light detected\",\n            0x0010 : \"Flash did not fire, compulsory flash mode\",\n            0x0018 : \"Flash did not fire, auto mode\",\n            0x0019 : \"Flash fired, auto mode\",\n            0x001D : \"Flash fired, auto mode, return light not detected\",\n            0x001F : \"Flash fired, auto mode, return light detected\",\n            0x0020 : \"No flash function\",\n            0x0041 : \"Flash fired, red-eye reduction mode\",\n            0x0045 : \"Flash fired, red-eye reduction mode, return light not detected\",\n            0x0047 : \"Flash fired, red-eye reduction mode, return light detected\",\n            0x0049 : \"Flash fired, compulsory flash mode, red-eye reduction mode\",\n            0x004D : \"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected\",\n            0x004F : \"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected\",\n            0x0059 : \"Flash fired, auto mode, red-eye reduction mode\",\n            0x005D : \"Flash fired, auto mode, return light not detected, red-eye reduction mode\",\n            0x005F : \"Flash fired, auto mode, return light detected, red-eye reduction mode\"\n        },\n        SensingMethod : {\n            1 : \"Not defined\",\n            2 : \"One-chip color area sensor\",\n            3 : \"Two-chip color area sensor\",\n            4 : \"Three-chip color area sensor\",\n            5 : \"Color sequential area sensor\",\n            7 : \"Trilinear sensor\",\n            8 : \"Color sequential linear sensor\"\n        },\n        SceneCaptureType : {\n            0 : \"Standard\",\n            1 : \"Landscape\",\n            2 : \"Portrait\",\n            3 : \"Night scene\"\n        },\n        SceneType : {\n            1 : \"Directly photographed\"\n        },\n        CustomRendered : {\n            0 : \"Normal process\",\n            1 : \"Custom process\"\n        },\n        WhiteBalance : {\n            0 : \"Auto white balance\",\n            1 : \"Manual white balance\"\n        },\n        GainControl : {\n            0 : \"None\",\n            1 : \"Low gain up\",\n            2 : \"High gain up\",\n            3 : \"Low gain down\",\n            4 : \"High gain down\"\n        },\n        Contrast : {\n            0 : \"Normal\",\n            1 : \"Soft\",\n            2 : \"Hard\"\n        },\n        Saturation : {\n            0 : \"Normal\",\n            1 : \"Low saturation\",\n            2 : \"High saturation\"\n        },\n        Sharpness : {\n            0 : \"Normal\",\n            1 : \"Soft\",\n            2 : \"Hard\"\n        },\n        SubjectDistanceRange : {\n            0 : \"Unknown\",\n            1 : \"Macro\",\n            2 : \"Close view\",\n            3 : \"Distant view\"\n        },\n        FileSource : {\n            3 : \"DSC\"\n        },\n\n        Components : {\n            0 : \"\",\n            1 : \"Y\",\n            2 : \"Cb\",\n            3 : \"Cr\",\n            4 : \"R\",\n            5 : \"G\",\n            6 : \"B\"\n        }\n    };\n\n    function addEvent(element, event, handler) {\n        if (element.addEventListener) {\n            element.addEventListener(event, handler, false);\n        } else if (element.attachEvent) {\n            element.attachEvent(\"on\" + event, handler);\n        }\n    }\n\n    function imageHasData(img) {\n        return !!(img.exifdata);\n    }\n\n\n    function base64ToArrayBuffer(base64, contentType) {\n        contentType = contentType || base64.match(/^data\\:([^\\;]+)\\;base64,/mi)[1] || ''; // e.g. 'data:image/jpeg;base64,...' => 'image/jpeg'\n        base64 = base64.replace(/^data\\:([^\\;]+)\\;base64,/gmi, '');\n        var binary = atob(base64);\n        var len = binary.length;\n        var buffer = new ArrayBuffer(len);\n        var view = new Uint8Array(buffer);\n        for (var i = 0; i < len; i++) {\n            view[i] = binary.charCodeAt(i);\n        }\n        return buffer;\n    }\n\n    function objectURLToBlob(url, callback) {\n        var http = new XMLHttpRequest();\n        http.open(\"GET\", url, true);\n        http.responseType = \"blob\";\n        http.onload = function(e) {\n            if (this.status == 200 || this.status === 0) {\n                callback(this.response);\n            }\n        };\n        http.send();\n    }\n\n    function getImageData(img, callback) {\n        function handleBinaryFile(binFile) {\n            var data = findEXIFinJPEG(binFile);\n            img.exifdata = data || {};\n            var iptcdata = findIPTCinJPEG(binFile);\n            img.iptcdata = iptcdata || {};\n            if (EXIF.isXmpEnabled) {\n               var xmpdata= findXMPinJPEG(binFile);\n               img.xmpdata = xmpdata || {};               \n            }\n            if (callback) {\n                callback.call(img);\n            }\n        }\n\n        if (img.src) {\n            if (/^data\\:/i.test(img.src)) { // Data URI\n                var arrayBuffer = base64ToArrayBuffer(img.src);\n                handleBinaryFile(arrayBuffer);\n\n            } else if (/^blob\\:/i.test(img.src)) { // Object URL\n                var fileReader = new FileReader();\n                fileReader.onload = function(e) {\n                    handleBinaryFile(e.target.result);\n                };\n                objectURLToBlob(img.src, function (blob) {\n                    fileReader.readAsArrayBuffer(blob);\n                });\n            } else {\n                var http = new XMLHttpRequest();\n                http.onload = function() {\n                    if (this.status == 200 || this.status === 0) {\n                        handleBinaryFile(http.response);\n                    } else {\n                        throw \"Could not load image\";\n                    }\n                    http = null;\n                };\n                http.open(\"GET\", img.src, true);\n                http.responseType = \"arraybuffer\";\n                http.send(null);\n            }\n        } else if (self.FileReader && (img instanceof self.Blob || img instanceof self.File)) {\n            var fileReader = new FileReader();\n            fileReader.onload = function(e) {\n                if (debug) console.log(\"Got file of length \" + e.target.result.byteLength);\n                handleBinaryFile(e.target.result);\n            };\n\n            fileReader.readAsArrayBuffer(img);\n        }\n    }\n\n    function findEXIFinJPEG(file) {\n        var dataView = new DataView(file);\n\n        if (debug) console.log(\"Got file of length \" + file.byteLength);\n        if ((dataView.getUint8(0) != 0xFF) || (dataView.getUint8(1) != 0xD8)) {\n            if (debug) console.log(\"Not a valid JPEG\");\n            return false; // not a valid jpeg\n        }\n\n        var offset = 2,\n            length = file.byteLength,\n            marker;\n\n        while (offset < length) {\n            if (dataView.getUint8(offset) != 0xFF) {\n                if (debug) console.log(\"Not a valid marker at offset \" + offset + \", found: \" + dataView.getUint8(offset));\n                return false; // not a valid marker, something is wrong\n            }\n\n            marker = dataView.getUint8(offset + 1);\n            if (debug) console.log(marker);\n\n            // we could implement handling for other markers here,\n            // but we're only looking for 0xFFE1 for EXIF data\n\n            if (marker == 225) {\n                if (debug) console.log(\"Found 0xFFE1 marker\");\n\n                return readEXIFData(dataView, offset + 4, dataView.getUint16(offset + 2) - 2);\n\n                // offset += 2 + file.getShortAt(offset+2, true);\n\n            } else {\n                offset += 2 + dataView.getUint16(offset+2);\n            }\n\n        }\n\n    }\n\n    function findIPTCinJPEG(file) {\n        var dataView = new DataView(file);\n\n        if (debug) console.log(\"Got file of length \" + file.byteLength);\n        if ((dataView.getUint8(0) != 0xFF) || (dataView.getUint8(1) != 0xD8)) {\n            if (debug) console.log(\"Not a valid JPEG\");\n            return false; // not a valid jpeg\n        }\n\n        var offset = 2,\n            length = file.byteLength;\n\n\n        var isFieldSegmentStart = function(dataView, offset){\n            return (\n                dataView.getUint8(offset) === 0x38 &&\n                dataView.getUint8(offset+1) === 0x42 &&\n                dataView.getUint8(offset+2) === 0x49 &&\n                dataView.getUint8(offset+3) === 0x4D &&\n                dataView.getUint8(offset+4) === 0x04 &&\n                dataView.getUint8(offset+5) === 0x04\n            );\n        };\n\n        while (offset < length) {\n\n            if ( isFieldSegmentStart(dataView, offset )){\n\n                // Get the length of the name header (which is padded to an even number of bytes)\n                var nameHeaderLength = dataView.getUint8(offset+7);\n                if(nameHeaderLength % 2 !== 0) nameHeaderLength += 1;\n                // Check for pre photoshop 6 format\n                if(nameHeaderLength === 0) {\n                    // Always 4\n                    nameHeaderLength = 4;\n                }\n\n                var startOffset = offset + 8 + nameHeaderLength;\n                var sectionLength = dataView.getUint16(offset + 6 + nameHeaderLength);\n\n                return readIPTCData(file, startOffset, sectionLength);\n\n                break;\n\n            }\n\n\n            // Not the marker, continue searching\n            offset++;\n\n        }\n\n    }\n    var IptcFieldMap = {\n        0x78 : 'caption',\n        0x6E : 'credit',\n        0x19 : 'keywords',\n        0x37 : 'dateCreated',\n        0x50 : 'byline',\n        0x55 : 'bylineTitle',\n        0x7A : 'captionWriter',\n        0x69 : 'headline',\n        0x74 : 'copyright',\n        0x0F : 'category'\n    };\n    function readIPTCData(file, startOffset, sectionLength){\n        var dataView = new DataView(file);\n        var data = {};\n        var fieldValue, fieldName, dataSize, segmentType, segmentSize;\n        var segmentStartPos = startOffset;\n        while(segmentStartPos < startOffset+sectionLength) {\n            if(dataView.getUint8(segmentStartPos) === 0x1C && dataView.getUint8(segmentStartPos+1) === 0x02){\n                segmentType = dataView.getUint8(segmentStartPos+2);\n                if(segmentType in IptcFieldMap) {\n                    dataSize = dataView.getInt16(segmentStartPos+3);\n                    segmentSize = dataSize + 5;\n                    fieldName = IptcFieldMap[segmentType];\n                    fieldValue = getStringFromDB(dataView, segmentStartPos+5, dataSize);\n                    // Check if we already stored a value with this name\n                    if(data.hasOwnProperty(fieldName)) {\n                        // Value already stored with this name, create multivalue field\n                        if(data[fieldName] instanceof Array) {\n                            data[fieldName].push(fieldValue);\n                        }\n                        else {\n                            data[fieldName] = [data[fieldName], fieldValue];\n                        }\n                    }\n                    else {\n                        data[fieldName] = fieldValue;\n                    }\n                }\n\n            }\n            segmentStartPos++;\n        }\n        return data;\n    }\n\n\n\n    function readTags(file, tiffStart, dirStart, strings, bigEnd) {\n        var entries = file.getUint16(dirStart, !bigEnd),\n            tags = {},\n            entryOffset, tag,\n            i;\n\n        for (i=0;i<entries;i++) {\n            entryOffset = dirStart + i*12 + 2;\n            tag = strings[file.getUint16(entryOffset, !bigEnd)];\n            if (!tag && debug) console.log(\"Unknown tag: \" + file.getUint16(entryOffset, !bigEnd));\n            tags[tag] = readTagValue(file, entryOffset, tiffStart, dirStart, bigEnd);\n        }\n        return tags;\n    }\n\n\n    function readTagValue(file, entryOffset, tiffStart, dirStart, bigEnd) {\n        var type = file.getUint16(entryOffset+2, !bigEnd),\n            numValues = file.getUint32(entryOffset+4, !bigEnd),\n            valueOffset = file.getUint32(entryOffset+8, !bigEnd) + tiffStart,\n            offset,\n            vals, val, n,\n            numerator, denominator;\n\n        switch (type) {\n            case 1: // byte, 8-bit unsigned int\n            case 7: // undefined, 8-bit byte, value depending on field\n                if (numValues == 1) {\n                    return file.getUint8(entryOffset + 8, !bigEnd);\n                } else {\n                    offset = numValues > 4 ? valueOffset : (entryOffset + 8);\n                    vals = [];\n                    for (n=0;n<numValues;n++) {\n                        vals[n] = file.getUint8(offset + n);\n                    }\n                    return vals;\n                }\n\n            case 2: // ascii, 8-bit byte\n                offset = numValues > 4 ? valueOffset : (entryOffset + 8);\n                return getStringFromDB(file, offset, numValues-1);\n\n            case 3: // short, 16 bit int\n                if (numValues == 1) {\n                    return file.getUint16(entryOffset + 8, !bigEnd);\n                } else {\n                    offset = numValues > 2 ? valueOffset : (entryOffset + 8);\n                    vals = [];\n                    for (n=0;n<numValues;n++) {\n                        vals[n] = file.getUint16(offset + 2*n, !bigEnd);\n                    }\n                    return vals;\n                }\n\n            case 4: // long, 32 bit int\n                if (numValues == 1) {\n                    return file.getUint32(entryOffset + 8, !bigEnd);\n                } else {\n                    vals = [];\n                    for (n=0;n<numValues;n++) {\n                        vals[n] = file.getUint32(valueOffset + 4*n, !bigEnd);\n                    }\n                    return vals;\n                }\n\n            case 5:    // rational = two long values, first is numerator, second is denominator\n                if (numValues == 1) {\n                    numerator = file.getUint32(valueOffset, !bigEnd);\n                    denominator = file.getUint32(valueOffset+4, !bigEnd);\n                    val = new Number(numerator / denominator);\n                    val.numerator = numerator;\n                    val.denominator = denominator;\n                    return val;\n                } else {\n                    vals = [];\n                    for (n=0;n<numValues;n++) {\n                        numerator = file.getUint32(valueOffset + 8*n, !bigEnd);\n                        denominator = file.getUint32(valueOffset+4 + 8*n, !bigEnd);\n                        vals[n] = new Number(numerator / denominator);\n                        vals[n].numerator = numerator;\n                        vals[n].denominator = denominator;\n                    }\n                    return vals;\n                }\n\n            case 9: // slong, 32 bit signed int\n                if (numValues == 1) {\n                    return file.getInt32(entryOffset + 8, !bigEnd);\n                } else {\n                    vals = [];\n                    for (n=0;n<numValues;n++) {\n                        vals[n] = file.getInt32(valueOffset + 4*n, !bigEnd);\n                    }\n                    return vals;\n                }\n\n            case 10: // signed rational, two slongs, first is numerator, second is denominator\n                if (numValues == 1) {\n                    return file.getInt32(valueOffset, !bigEnd) / file.getInt32(valueOffset+4, !bigEnd);\n                } else {\n                    vals = [];\n                    for (n=0;n<numValues;n++) {\n                        vals[n] = file.getInt32(valueOffset + 8*n, !bigEnd) / file.getInt32(valueOffset+4 + 8*n, !bigEnd);\n                    }\n                    return vals;\n                }\n        }\n    }\n\n    /**\n    * Given an IFD (Image File Directory) start offset\n    * returns an offset to next IFD or 0 if it's the last IFD.\n    */\n    function getNextIFDOffset(dataView, dirStart, bigEnd){\n        //the first 2bytes means the number of directory entries contains in this IFD\n        var entries = dataView.getUint16(dirStart, !bigEnd);\n\n        // After last directory entry, there is a 4bytes of data,\n        // it means an offset to next IFD.\n        // If its value is '0x00000000', it means this is the last IFD and there is no linked IFD.\n\n        return dataView.getUint32(dirStart + 2 + entries * 12, !bigEnd); // each entry is 12 bytes long\n    }\n\n    function readThumbnailImage(dataView, tiffStart, firstIFDOffset, bigEnd){\n        // get the IFD1 offset\n        var IFD1OffsetPointer = getNextIFDOffset(dataView, tiffStart+firstIFDOffset, bigEnd);\n\n        if (!IFD1OffsetPointer) {\n            // console.log('******** IFD1Offset is empty, image thumb not found ********');\n            return {};\n        }\n        else if (IFD1OffsetPointer > dataView.byteLength) { // this should not happen\n            // console.log('******** IFD1Offset is outside the bounds of the DataView ********');\n            return {};\n        }\n        // console.log('*******  thumbnail IFD offset (IFD1) is: %s', IFD1OffsetPointer);\n\n        var thumbTags = readTags(dataView, tiffStart, tiffStart + IFD1OffsetPointer, IFD1Tags, bigEnd)\n\n        // EXIF 2.3 specification for JPEG format thumbnail\n\n        // If the value of Compression(0x0103) Tag in IFD1 is '6', thumbnail image format is JPEG.\n        // Most of Exif image uses JPEG format for thumbnail. In that case, you can get offset of thumbnail\n        // by JpegIFOffset(0x0201) Tag in IFD1, size of thumbnail by JpegIFByteCount(0x0202) Tag.\n        // Data format is ordinary JPEG format, starts from 0xFFD8 and ends by 0xFFD9. It seems that\n        // JPEG format and 160x120pixels of size are recommended thumbnail format for Exif2.1 or later.\n\n        if (thumbTags['Compression']) {\n            // console.log('Thumbnail image found!');\n\n            switch (thumbTags['Compression']) {\n                case 6:\n                    // console.log('Thumbnail image format is JPEG');\n                    if (thumbTags.JpegIFOffset && thumbTags.JpegIFByteCount) {\n                    // extract the thumbnail\n                        var tOffset = tiffStart + thumbTags.JpegIFOffset;\n                        var tLength = thumbTags.JpegIFByteCount;\n                        thumbTags['blob'] = new Blob([new Uint8Array(dataView.buffer, tOffset, tLength)], {\n                            type: 'image/jpeg'\n                        });\n                    }\n                break;\n\n            case 1:\n                console.log(\"Thumbnail image format is TIFF, which is not implemented.\");\n                break;\n            default:\n                console.log(\"Unknown thumbnail image format '%s'\", thumbTags['Compression']);\n            }\n        }\n        else if (thumbTags['PhotometricInterpretation'] == 2) {\n            console.log(\"Thumbnail image format is RGB, which is not implemented.\");\n        }\n        return thumbTags;\n    }\n\n    function getStringFromDB(buffer, start, length) {\n        var outstr = \"\";\n        for (n = start; n < start+length; n++) {\n            outstr += String.fromCharCode(buffer.getUint8(n));\n        }\n        return outstr;\n    }\n\n    function readEXIFData(file, start) {\n        if (getStringFromDB(file, start, 4) != \"Exif\") {\n            if (debug) console.log(\"Not valid EXIF data! \" + getStringFromDB(file, start, 4));\n            return false;\n        }\n\n        var bigEnd,\n            tags, tag,\n            exifData, gpsData,\n            tiffOffset = start + 6;\n\n        // test for TIFF validity and endianness\n        if (file.getUint16(tiffOffset) == 0x4949) {\n            bigEnd = false;\n        } else if (file.getUint16(tiffOffset) == 0x4D4D) {\n            bigEnd = true;\n        } else {\n            if (debug) console.log(\"Not valid TIFF data! (no 0x4949 or 0x4D4D)\");\n            return false;\n        }\n\n        if (file.getUint16(tiffOffset+2, !bigEnd) != 0x002A) {\n            if (debug) console.log(\"Not valid TIFF data! (no 0x002A)\");\n            return false;\n        }\n\n        var firstIFDOffset = file.getUint32(tiffOffset+4, !bigEnd);\n\n        if (firstIFDOffset < 0x00000008) {\n            if (debug) console.log(\"Not valid TIFF data! (First offset less than 8)\", file.getUint32(tiffOffset+4, !bigEnd));\n            return false;\n        }\n\n        tags = readTags(file, tiffOffset, tiffOffset + firstIFDOffset, TiffTags, bigEnd);\n\n        if (tags.ExifIFDPointer) {\n            exifData = readTags(file, tiffOffset, tiffOffset + tags.ExifIFDPointer, ExifTags, bigEnd);\n            for (tag in exifData) {\n                switch (tag) {\n                    case \"LightSource\" :\n                    case \"Flash\" :\n                    case \"MeteringMode\" :\n                    case \"ExposureProgram\" :\n                    case \"SensingMethod\" :\n                    case \"SceneCaptureType\" :\n                    case \"SceneType\" :\n                    case \"CustomRendered\" :\n                    case \"WhiteBalance\" :\n                    case \"GainControl\" :\n                    case \"Contrast\" :\n                    case \"Saturation\" :\n                    case \"Sharpness\" :\n                    case \"SubjectDistanceRange\" :\n                    case \"FileSource\" :\n                        exifData[tag] = StringValues[tag][exifData[tag]];\n                        break;\n\n                    case \"ExifVersion\" :\n                    case \"FlashpixVersion\" :\n                        exifData[tag] = String.fromCharCode(exifData[tag][0], exifData[tag][1], exifData[tag][2], exifData[tag][3]);\n                        break;\n\n                    case \"ComponentsConfiguration\" :\n                        exifData[tag] =\n                            StringValues.Components[exifData[tag][0]] +\n                            StringValues.Components[exifData[tag][1]] +\n                            StringValues.Components[exifData[tag][2]] +\n                            StringValues.Components[exifData[tag][3]];\n                        break;\n                }\n                tags[tag] = exifData[tag];\n            }\n        }\n\n        if (tags.GPSInfoIFDPointer) {\n            gpsData = readTags(file, tiffOffset, tiffOffset + tags.GPSInfoIFDPointer, GPSTags, bigEnd);\n            for (tag in gpsData) {\n                switch (tag) {\n                    case \"GPSVersionID\" :\n                        gpsData[tag] = gpsData[tag][0] +\n                            \".\" + gpsData[tag][1] +\n                            \".\" + gpsData[tag][2] +\n                            \".\" + gpsData[tag][3];\n                        break;\n                }\n                tags[tag] = gpsData[tag];\n            }\n        }\n\n        // extract thumbnail\n        tags['thumbnail'] = readThumbnailImage(file, tiffOffset, firstIFDOffset, bigEnd);\n\n        return tags;\n    }\n\n   function findXMPinJPEG(file) {\n\n        if (!('DOMParser' in self)) {\n            // console.warn('XML parsing not supported without DOMParser');\n            return;\n        }\n        var dataView = new DataView(file);\n\n        if (debug) console.log(\"Got file of length \" + file.byteLength);\n        if ((dataView.getUint8(0) != 0xFF) || (dataView.getUint8(1) != 0xD8)) {\n           if (debug) console.log(\"Not a valid JPEG\");\n           return false; // not a valid jpeg\n        }\n\n        var offset = 2,\n            length = file.byteLength,\n            dom = new DOMParser();\n\n        while (offset < (length-4)) {\n            if (getStringFromDB(dataView, offset, 4) == \"http\") {\n                var startOffset = offset - 1;\n                var sectionLength = dataView.getUint16(offset - 2) - 1;\n                var xmpString = getStringFromDB(dataView, startOffset, sectionLength)\n                var xmpEndIndex = xmpString.indexOf('xmpmeta>') + 8;\n                xmpString = xmpString.substring( xmpString.indexOf( '<x:xmpmeta' ), xmpEndIndex );\n\n                var indexOfXmp = xmpString.indexOf('x:xmpmeta') + 10\n                //Many custom written programs embed xmp/xml without any namespace. Following are some of them.\n                //Without these namespaces, XML is thought to be invalid by parsers\n                xmpString = xmpString.slice(0, indexOfXmp)\n                            + 'xmlns:Iptc4xmpCore=\"http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/\" '\n                            + 'xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" '\n                            + 'xmlns:tiff=\"http://ns.adobe.com/tiff/1.0/\" '\n                            + 'xmlns:plus=\"http://schemas.android.com/apk/lib/com.google.android.gms.plus\" '\n                            + 'xmlns:ext=\"http://www.gettyimages.com/xsltExtension/1.0\" '\n                            + 'xmlns:exif=\"http://ns.adobe.com/exif/1.0/\" '\n                            + 'xmlns:stEvt=\"http://ns.adobe.com/xap/1.0/sType/ResourceEvent#\" '\n                            + 'xmlns:stRef=\"http://ns.adobe.com/xap/1.0/sType/ResourceRef#\" '\n                            + 'xmlns:crs=\"http://ns.adobe.com/camera-raw-settings/1.0/\" '\n                            + 'xmlns:xapGImg=\"http://ns.adobe.com/xap/1.0/g/img/\" '\n                            + 'xmlns:Iptc4xmpExt=\"http://iptc.org/std/Iptc4xmpExt/2008-02-29/\" '\n                            + xmpString.slice(indexOfXmp)\n\n                var domDocument = dom.parseFromString( xmpString, 'text/xml' );\n                return xml2Object(domDocument);\n            } else{\n             offset++;\n            }\n        }\n    }\n\n    function xml2json(xml) {\n        var json = {};\n      \n        if (xml.nodeType == 1) { // element node\n          if (xml.attributes.length > 0) {\n            json['@attributes'] = {};\n            for (var j = 0; j < xml.attributes.length; j++) {\n              var attribute = xml.attributes.item(j);\n              json['@attributes'][attribute.nodeName] = attribute.nodeValue;\n            }\n          }\n        } else if (xml.nodeType == 3) { // text node\n          return xml.nodeValue;\n        }\n      \n        // deal with children\n        if (xml.hasChildNodes()) {\n          for(var i = 0; i < xml.childNodes.length; i++) {\n            var child = xml.childNodes.item(i);\n            var nodeName = child.nodeName;\n            if (json[nodeName] == null) {\n              json[nodeName] = xml2json(child);\n            } else {\n              if (json[nodeName].push == null) {\n                var old = json[nodeName];\n                json[nodeName] = [];\n                json[nodeName].push(old);\n              }\n              json[nodeName].push(xml2json(child));\n            }\n          }\n        }\n        \n        return json;\n    }\n\n    function xml2Object(xml) {\n        try {\n            var obj = {};\n            if (xml.children.length > 0) {\n              for (var i = 0; i < xml.children.length; i++) {\n                var item = xml.children.item(i);\n                var attributes = item.attributes;\n                for(var idx in attributes) {\n                    var itemAtt = attributes[idx];\n                    var dataKey = itemAtt.nodeName;\n                    var dataValue = itemAtt.nodeValue;\n\n                    if(dataKey !== undefined) {\n                        obj[dataKey] = dataValue;\n                    }\n                }\n                var nodeName = item.nodeName;\n\n                if (typeof (obj[nodeName]) == \"undefined\") {\n                  obj[nodeName] = xml2json(item);\n                } else {\n                  if (typeof (obj[nodeName].push) == \"undefined\") {\n                    var old = obj[nodeName];\n\n                    obj[nodeName] = [];\n                    obj[nodeName].push(old);\n                  }\n                  obj[nodeName].push(xml2json(item));\n                }\n              }\n            } else {\n              obj = xml.textContent;\n            }\n            return obj;\n          } catch (e) {\n              console.log(e.message);\n          }\n    }\n\n    EXIF.enableXmp = function() {\n        EXIF.isXmpEnabled = true;\n    }\n\n    EXIF.disableXmp = function() {\n        EXIF.isXmpEnabled = false;\n    }\n\n    EXIF.getData = function(img, callback) {\n        if (((self.Image && img instanceof self.Image)\n            || (self.HTMLImageElement && img instanceof self.HTMLImageElement))\n            && !img.complete)\n            return false;\n\n        if (!imageHasData(img)) {\n            getImageData(img, callback);\n        } else {\n            if (callback) {\n                callback.call(img);\n            }\n        }\n        return true;\n    }\n\n    EXIF.getTag = function(img, tag) {\n        if (!imageHasData(img)) return;\n        return img.exifdata[tag];\n    }\n    \n    EXIF.getIptcTag = function(img, tag) {\n        if (!imageHasData(img)) return;\n        return img.iptcdata[tag];\n    }\n\n    EXIF.getAllTags = function(img) {\n        if (!imageHasData(img)) return {};\n        var a,\n            data = img.exifdata,\n            tags = {};\n        for (a in data) {\n            if (data.hasOwnProperty(a)) {\n                tags[a] = data[a];\n            }\n        }\n        return tags;\n    }\n    \n    EXIF.getAllIptcTags = function(img) {\n        if (!imageHasData(img)) return {};\n        var a,\n            data = img.iptcdata,\n            tags = {};\n        for (a in data) {\n            if (data.hasOwnProperty(a)) {\n                tags[a] = data[a];\n            }\n        }\n        return tags;\n    }\n\n    EXIF.pretty = function(img) {\n        if (!imageHasData(img)) return \"\";\n        var a,\n            data = img.exifdata,\n            strPretty = \"\";\n        for (a in data) {\n            if (data.hasOwnProperty(a)) {\n                if (typeof data[a] == \"object\") {\n                    if (data[a] instanceof Number) {\n                        strPretty += a + \" : \" + data[a] + \" [\" + data[a].numerator + \"/\" + data[a].denominator + \"]\\r\\n\";\n                    } else {\n                        strPretty += a + \" : [\" + data[a].length + \" values]\\r\\n\";\n                    }\n                } else {\n                    strPretty += a + \" : \" + data[a] + \"\\r\\n\";\n                }\n            }\n        }\n        return strPretty;\n    }\n\n    EXIF.readFromBinaryFile = function(file) {\n        return findEXIFinJPEG(file);\n    }\n\n    if (typeof define === 'function' && define.amd) {\n        define('exif-js', [], function() {\n            return EXIF;\n        });\n    }\n}.call(this));\n\n"],"sourceRoot":""}