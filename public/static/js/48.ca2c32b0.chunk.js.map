{"version":3,"sources":["../node_modules/@ant-design/icons-svg/es/asn/UploadOutlined.js","../node_modules/@ant-design/icons/es/icons/UploadOutlined.js","components/uploadQiniu/file.js"],"names":["UploadOutlined","props","ref","React","AntdIcon","Object","assign","icon","UploadOutlinedSvg","displayName","UploadFile","handleChange","info","file","status","onChange","multiple","result","fileList","pop","uploadIns","setState","map","response","title","name","type","doUpload","a","getToken","token","params","config","useCdnDomain","region","that","key","uid","substr","indexOf","putExtra","fname","mimeType","observable","qiniu","subscribe","next","res","onProgress","percent","total","error","err","console","log","onError","complete","warn","onSuccess","this","forEach","item","index","url","CONFIG","QINIU","read","axios","token_url","header","method","data","cmd","seqno","verifycode","version","uploadToken","isLt","size","message","action","customRequest","beforeUpload","Component"],"mappings":"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","file":"static/js/48.ca2c32b0.chunk.js","sourcesContent":["// This icon file is generated automatically.\nvar UploadOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z\" } }] }, \"name\": \"upload\", \"theme\": \"outlined\" };\nexport default UploadOutlined;\n","// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport UploadOutlinedSvg from \"@ant-design/icons-svg/es/asn/UploadOutlined\";\nimport AntdIcon from '../components/AntdIcon';\n\nvar UploadOutlined = function UploadOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, Object.assign({}, props, {\n    ref: ref,\n    icon: UploadOutlinedSvg\n  }));\n};\n\nUploadOutlined.displayName = 'UploadOutlined';\nexport default /*#__PURE__*/React.forwardRef(UploadOutlined);","import React, { Component } from 'react';\r\nimport { Upload, message, Button } from 'antd';\r\nimport { UploadOutlined } from '@ant-design/icons';\r\nimport axios from 'axios';\r\nimport CONFIG from '@/config';\r\nimport * as qiniu from 'qiniu-js';\r\nimport './style.less';\r\n\r\nclass UploadFile extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.observable = {};\r\n  }\r\n\r\n  componentDidMount (){\r\n    const { fileList, } = this.props;\r\n      // console.warn('转入的文件:', fileList, this.props);\r\n    if(fileList){\r\n      fileList.forEach((item, index) => {\r\n        item.uid = item.uid || (item.key ? item.key.substr(0, item.key.indexOf('.')) : index);\r\n        item.status = 'done';\r\n        item.name = item.name || item.title;\r\n        item.url = item.url || `${CONFIG.QINIU.read}${item.key}`;\r\n      });\r\n      this.uploadIns.setState({\r\n        fileList\r\n      });\r\n    }\r\n  }\r\n\r\n  handleChange = info => {\r\n    if (info.file.status === 'uploading') {\r\n      return;\r\n    }\r\n    if (info.file.status === 'done') {\r\n      const { onChange, multiple } = this.props;\r\n      if(onChange) {\r\n        let result = [];\r\n        result = multiple ? info.fileList : [info.fileList.pop()];\r\n        this.uploadIns.setState({\r\n          fileList: result\r\n        });\r\n        onChange(result.map(file => {\r\n          return {\r\n            ...file.response || {},\r\n            title: file.name,\r\n            type: file.type\r\n          }\r\n        }));\r\n      }\r\n    }\r\n  };\r\n  /**\r\n   * 取token\r\n   */\r\n  async getToken() {\r\n    let res = await axios({\r\n      url: CONFIG.QINIU.token_url,\r\n      header: { 'content-type': 'application/json' },\r\n      method: 'put',\r\n      data: {\r\n        cmd: 'token',\r\n        data: {},\r\n        seqno: 'no',\r\n        verifycode: 'no',\r\n        version: '1.0'\r\n      },\r\n    });\r\n    return res.data.status === 0 ? res.data.data.uploadToken : '';\r\n  }\r\n  /**\r\n   * 七牛云上传\r\n   */\r\n  doUpload = async ({ file }) => {\r\n    let token = await this.getToken();\r\n    const { params={} } = this.props;\r\n    let config = {\r\n        useCdnDomain: true,\r\n        region: 'z2'\r\n      },\r\n      that = this,\r\n      key = `${file.uid}${file.name.substr(file.name.indexOf('.'))}`,\r\n      putExtra = {\r\n        fname: file.name,\r\n        params,\r\n        mimeType: [] || null\r\n      };\r\n    // console.warn(token, file, key);\r\n    this.observable = qiniu.upload(file, key, token, putExtra, config);\r\n    this.observable.subscribe({\r\n      next(res){\r\n        that.uploadIns.onProgress({percent: res.total.percent}, file);\r\n      },\r\n      error(err){\r\n        console.log('-->',err)\r\n        that.uploadIns.onError(err, {}, file);\r\n      },\r\n      complete(res){\r\n        console.warn('上传成功', res, file);\r\n        that.uploadIns.onSuccess(res, file);\r\n      }\r\n    });\r\n  }\r\n\r\n  beforeUpload(file, fileList) {\r\n    // console.log(file, fileList)\r\n    const isLt = file.size / 1024 / 1024 < 50;\r\n    if (!isLt) {\r\n      message.error('文件大小不能大于50MB!');\r\n    }\r\n    return isLt;\r\n  }\r\n\r\n  render() {\r\n    const { multiple, name } = this.props;\r\n    return (\r\n      <Upload\r\n        ref={uploadIns => this.uploadIns = uploadIns}\r\n        multiple={multiple}\r\n        name={name}\r\n        action={CONFIG.QINIU.action}\r\n        customRequest={this.doUpload}\r\n        beforeUpload={this.beforeUpload}\r\n        onChange={this.handleChange}\r\n      >\r\n        <Button>\r\n          <UploadOutlined /> 上传文件\r\n        </Button>\r\n      </Upload>\r\n    );\r\n  }\r\n}\r\n\r\nexport default UploadFile;\r\n"],"sourceRoot":""}