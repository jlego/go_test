{"version":3,"sources":["../node_modules/@ant-design/icons-svg/es/asn/SyncOutlined.js","../node_modules/@ant-design/icons/es/icons/SyncOutlined.js","components/uploadQiniu/picture.js"],"names":["SyncOutlined","props","ref","React","AntdIcon","Object","assign","icon","SyncOutlinedSvg","displayName","UploadPicture","handleChange","info","file","status","onChange","multiple","result","fileList","pop","uploadIns","setState","map","response","title","name","type","img","callback","reader","FileReader","addEventListener","readAsDataURL","getBase64","originFileObj","imageUrl","loading","doUpload","a","getToken","token","params","config","useCdnDomain","region","that","key","uid","substr","indexOf","putExtra","fname","mimeType","observable","qiniu","subscribe","next","res","onProgress","percent","total","error","err","console","log","onError","complete","warn","onSuccess","state","this","length","CONFIG","QINIU","read","axios","url","token_url","header","method","data","cmd","seqno","verifycode","version","uploadToken","isImage","includes","message","isLt2M","size","uploadButton","spin","PlusOutlined","className","listType","showUploadList","action","customRequest","beforeUpload","src","alt","Component"],"mappings":"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","file":"static/js/49.e75c4906.chunk.js","sourcesContent":["// This icon file is generated automatically.\nvar SyncOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z\" } }] }, \"name\": \"sync\", \"theme\": \"outlined\" };\nexport default SyncOutlined;\n","// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport SyncOutlinedSvg from \"@ant-design/icons-svg/es/asn/SyncOutlined\";\nimport AntdIcon from '../components/AntdIcon';\n\nvar SyncOutlined = function SyncOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, Object.assign({}, props, {\n    ref: ref,\n    icon: SyncOutlinedSvg\n  }));\n};\n\nSyncOutlined.displayName = 'SyncOutlined';\nexport default /*#__PURE__*/React.forwardRef(SyncOutlined);","import React, { Component } from 'react';\r\nimport { Upload, message, } from 'antd';\r\nimport { SyncOutlined, PlusOutlined } from '@ant-design/icons';\r\nimport axios from 'axios';\r\nimport CONFIG from '@/config';\r\nimport * as qiniu from 'qiniu-js';\r\nimport './style.less';\r\n\r\nfunction getBase64(img, callback) {\r\n  const reader = new FileReader();\r\n  reader.addEventListener('load', () => callback(reader.result));\r\n  reader.readAsDataURL(img);\r\n}\r\n// function getFileItem(file, fileList) {\r\n//   let matchKey = file.uid !== undefined ? 'uid' : 'name';\r\n//   return fileList.filter(function (item) {\r\n//     return item[matchKey] === file[matchKey];\r\n//   })[0];\r\n// }\r\n\r\nclass UploadPicture extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      imageUrl: '',\r\n      loading: false,\r\n    };\r\n    this.observable = {};\r\n  }\r\n\r\n  componentDidMount (){\r\n    const { fileList, } = this.props;\r\n      // console.warn('转入的文件:', fileList, this.props);\r\n    if(fileList){\r\n      this.uploadIns.setState({\r\n        fileList\r\n      });\r\n      this.setState({\r\n        imageUrl: fileList.length ? `${CONFIG.QINIU.read}${fileList[0].key}` : '',\r\n        loading: false,\r\n      });\r\n    }\r\n  }\r\n\r\n  handleChange = info => {\r\n    if (info.file.status === 'uploading') {\r\n      this.setState({\r\n        imageUrl: '',\r\n        loading: true,\r\n      });\r\n      return;\r\n    }\r\n    if (info.file.status === 'done') {\r\n      const { onChange, multiple } = this.props;\r\n      if(onChange) {\r\n        let result = [];\r\n        result = multiple ? info.fileList : [info.fileList.pop()];\r\n        this.uploadIns.setState({\r\n          fileList: result\r\n        });\r\n        onChange(result.map(file => {\r\n          return {\r\n            ...file.response || {},\r\n            title: file.name,\r\n            type: file.type\r\n          }\r\n        }));\r\n      }\r\n      getBase64(info.file.originFileObj, imageUrl =>\r\n        this.setState({\r\n          imageUrl,\r\n          loading: false,\r\n        }),\r\n      );\r\n    }\r\n  };\r\n  /**\r\n   * 取token\r\n   */\r\n  async getToken() {\r\n    let res = await axios({\r\n      url: CONFIG.QINIU.token_url,\r\n      header: { 'content-type': 'application/json' },\r\n      method: 'put',\r\n      data: {\r\n        cmd: 'token',\r\n        data: {},\r\n        seqno: 'no',\r\n        verifycode: 'no',\r\n        version: '1.0'\r\n      },\r\n    });\r\n    return res.data.status === 0 ? res.data.data.uploadToken : '';\r\n  }\r\n  /**\r\n   * 七牛云上传\r\n   */\r\n  doUpload = async ({ file }) => {\r\n    let token = await this.getToken();\r\n    const { params={} } = this.props;\r\n    let config = {\r\n        useCdnDomain: true,\r\n        region: 'z2'\r\n      },\r\n      that = this,\r\n      key = `${file.uid}${file.name.substr(file.name.indexOf('.'))}`,\r\n      putExtra = {\r\n        fname: file.name,\r\n        params,\r\n        mimeType: [] || null\r\n      };\r\n    // console.warn(token, file, key);\r\n    this.observable = qiniu.upload(file, key, token, putExtra, config);\r\n    this.observable.subscribe({\r\n      next(res){\r\n        that.uploadIns.onProgress({percent: res.total.percent}, file);\r\n      },\r\n      error(err){\r\n        console.log('-->',err)\r\n        that.uploadIns.onError(err, {}, file);\r\n      },\r\n      complete(res){\r\n        console.warn('上传成功', res, file);\r\n        that.uploadIns.onSuccess(res, file);\r\n      }\r\n    });\r\n  }\r\n\r\n  beforeUpload(file, fileList) {\r\n    // console.log(file, fileList)\r\n    let isImage = ['image/jpeg', 'image/png', 'image/gif'].includes(file.type);\r\n    if (!isImage) {\r\n      message.error('只能上传图片!');\r\n    }\r\n    const isLt2M = file.size / 1024 / 1024 < 2;\r\n    if (!isLt2M) {\r\n      message.error('图片大小不能大于2MB!');\r\n    }\r\n    return isImage && isLt2M;\r\n  }\r\n\r\n  render() {\r\n    const uploadButton = (\r\n      <div>\r\n        {this.state.loading ? <SyncOutlined spin /> : <PlusOutlined />}\r\n        <div className=\"ant-upload-text\">上传图片</div>\r\n      </div>\r\n    );\r\n    const { imageUrl } = this.state;\r\n    const { multiple, name } = this.props;\r\n    return (\r\n      <Upload\r\n        ref={uploadIns => this.uploadIns = uploadIns}\r\n        multiple={multiple}\r\n        name={name}\r\n        listType=\"picture-card\"\r\n        className=\"avatar-uploader\"\r\n        showUploadList={false}\r\n        action={CONFIG.QINIU.action}\r\n        customRequest={this.doUpload}\r\n        beforeUpload={this.beforeUpload}\r\n        onChange={this.handleChange}\r\n      >\r\n        {imageUrl ? <img src={imageUrl} alt=\"avatar\" /> : uploadButton}\r\n      </Upload>\r\n    );\r\n  }\r\n}\r\n\r\nexport default UploadPicture;\r\n"],"sourceRoot":""}